<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">

<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="chrome=1" />
  <link rel="shortcut icon" type="image/x-icon" href="//www.google.com/images/icons/product/sites-16.ico" />
  <link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/5acb68/system/app/images/apple-touch-icon.png" type="image/png" />

  <meta name="title" content="SPI (Serial Peripheral Interface) - QEEWiki" />
  <meta itemprop="name" content="SPI (Serial Peripheral Interface) - QEEWiki" />
  <meta property="og:title" content="SPI (Serial Peripheral Interface) - QEEWiki" />
  <meta name="description" content="Q's Electrical Engineering Wiki" />
  <meta itemprop="description" content="Q's Electrical Engineering Wiki" />
  <meta id="meta-tag-description" property="og:description" content="Q's Electrical Engineering Wiki" />
  <style type="text/css">
  </style>
  <link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/5acb68/system/app/themes/simple/standard-css-simple-ltr-ltr.css" />
  <link rel="stylesheet" type="text/css" href="/site/qeewiki/_/rsrc/1601537872000/system/app/css/overlay.css?cb=simple960px70175goog-ws-leftnonethemedefaultstandard" />
  <link rel="stylesheet" type="text/css" href="/site/qeewiki/_/rsrc/1601537872000/system/app/css/camelot/allthemes-view.css" />

  <title>SPI (Serial Peripheral Interface) - QEEWiki</title>
  <meta itemprop="image" content="/avr-guide/spi/ATmega%20-%20SPI.JPG" />
  <meta property="og:image" content="/avr-guide/spi/ATmega%20-%20SPI.JPG" />
</head>

<body xmlns="http://www.google.com/ns/jotspot" id="body" class="en">
  <div id="sites-page-toolbar" class="sites-header-divider">
    <div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;">
      <div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div>
    </div>
  </div>
  <div id="sites-chrome-everything-scrollbar">
    <div id="sites-chrome-everything" class="">
      <div id="sites-chrome-page-wrapper" style="direction: ltr">
        <div id="sites-chrome-page-wrapper-inside">
          <div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper">
            <table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0">
              <tr class="sites-header-primary-row" id="sites-chrome-userheader">
                <td id="sites-header-title" class="" role="banner" style="height: 70px">
                  <div class="sites-header-cell-buffer-wrapper">
                    <h2><a href="/avr-guide" dir="ltr" id="sites-chrome-userheader-title">QEEWiki</a></h2>
                  </div>
                </td>
              </tr>
              <tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
                <td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
                </td>
              </tr>
            </table>
          </div>
          <div id="sites-chrome-main-wrapper">
            <div id="sites-chrome-main-wrapper-inside">
              <table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
                <tr>
                  <td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:175px">
                    <div xmlns="http://www.w3.org/1999/xhtml" id="COMP_2bd" class="sites-embed" role="navigation">
                      <h4 class="sites-embed-title">Navigation</h4>
                      <div class="sites-embed-content sites-sidebar-nav">
                        <ul role="navigation" jotId="navList" class="has-expander">
                          <li class="topLevel nav-first ">
                            <div dir="ltr" style="padding-left: 19px;"><a href="https://github.com/chayanforyou" jotId="wuid:gx:3b2a480be041e60" class="sites-navigation-link topLevel">Home</a></div>
                          </li>
                          <li class="topLevel parent " wuid="gx:535b3f3a2562e7ad">
                            <div dir="ltr" style="padding-left: 0px;">
                              <div class="expander"></div><a href="/avr-guide" jotId="wuid:gx:535b3f3a2562e7ad" class="sites-navigation-link topLevel">My Books</a>
                            </div>
                            <ul role="navigation" class="has-expander">
                              <li class="">
                                <div dir="ltr" style="padding-left: 38px;"><a href="/avr-guide" jotId="wuid:gx:5233ae16d3813d0e" class="sites-navigation-link">AVR GUIDE</a></div>
                              </li>
                            </ul>
                          </li>
                          <li class="topLevel ">
                            <div dir="ltr" style="padding-left: 19px;"><a href="/avr-guide" jotId="wuid:gx:9d929f8c6b8e7ca" class="sites-navigation-link topLevel">Usefull Engineering Stuff</a></div>
                          </li>
                        </ul>
                      </div>
                    </div>
                    <div xmlns="http://www.w3.org/1999/xhtml" id="COMP_5818525579565211" class="sites-embed" role="navigation">
                      <h4 class="sites-embed-title">Resources</h4>
                      <div class="sites-embed-content sites-sidebar-nav">
                        <ul role="navigation" jotId="navList" class="has-expander">
                          <li class="topLevel nav-first ">
                            <div dir="ltr" style="padding-left: 19px;"><a href="http://www.sparkfun.com" class="sites-navigation-link topLevel">Sparkfun</a></div>
                          </li>
                          <li class="topLevel ">
                            <div dir="ltr" style="padding-left: 19px;"><a href="http://arduino.cc/en/Reference/HomePage" class="sites-navigation-link topLevel">Arduino Reference</a></div>
                          </li>
                          <li class="topLevel ">
                            <div dir="ltr" style="padding-left: 19px;"><a href="http://www.eevblog.com/" class="sites-navigation-link topLevel">EEVBlog</a></div>
                          </li>
                          <li class="topLevel ">
                            <div dir="ltr" style="padding-left: 19px;"><a href="http://fritzing.org/download/" class="sites-navigation-link topLevel">Fritzing Projects</a></div>
                          </li>
                          <li class="topLevel ">
                            <div dir="ltr" style="padding-left: 19px;"><a href="http://www.adafruit.com/" class="sites-navigation-link topLevel">Ada Fruit</a></div>
                          </li>
                          <li class="topLevel ">
                            <div dir="ltr" style="padding-left: 19px;"><a href="http://www.pololu.com/" class="sites-navigation-link topLevel">Pololu</a></div>
                          </li>
                          <li class="topLevel parent ">
                            <div dir="ltr" style="padding-left: 0px;">
                              <div class="expander"></div><a href="http://www.atmel.com" class="sites-navigation-link topLevel">Atmel</a>
                            </div>
                            <ul role="navigation" class="has-expander">
                              <li class="">
                                <div dir="ltr" style="padding-left: 38px;"><a href="https://ww1.microchip.com/downloads/aemDocuments/documents/MCU08/ProductDocuments/DataSheets/ATmega8A-Data-Sheet-DS40001974B.pdf" class="sites-navigation-link">Atmega8 Datasheet</a></div>
                              </li>
                              <li class="">
                                <div dir="ltr" style="padding-left: 38px;"><a href="https://ww1.microchip.com/downloads/en/DeviceDoc/ATmega48A-PA-88A-PA-168A-PA-328-P-DS-DS40002061B.pdf" class="sites-navigation-link">ATMega168/328 Datasheet</a></div>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </td>
                  <td id="sites-canvas-wrapper">
                    <div id="sites-canvas" role="main">
                      <div id="goog-ws-editor-toolbar-container"> </div>
                      <div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs">
                        <A href="/avr-guide" dir="ltr">My Books</A> &gt; <A href="/avr-guide" dir="ltr">AVR GUIDE</A> &gt;
                      </div>
                      <h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" align="left">
                        <span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">SPI (Serial Peripheral Interface)</span>
                      </h3>
                      <div id="sites-canvas-main" class="sites-canvas-main">
                        <div id="sites-canvas-main-content">
                          <div xmlns="http://www.w3.org/1999/xhtml" class="sites-layout-name-one-column-hf sites-layout-vbox">
                            <div class="sites-layout-tile sites-tile-name-header sites-layout-empty-tile">
                              <div dir="ltr"><br /></div>
                            </div>
                            <div class="sites-layout-tile sites-tile-name-content-1">
                              <div dir="ltr">
                                <font face="'courier new', monospace" size="3"><b>INTRODUCTION:</b></font>
                                <div><br /></div>
                                <div><span>    The SPI is a very simply Synchronous (</span><span>allows devices to send and receive data at the same time) </span><span>protocol developed by Motorola.   It is found on many devices and like I2C can be used to chain many devices together.  The SPI protocol can simply be implemented in software however, the AVR has hardware SPI capability.</span></div>
                                <div><span><br /></span></div>
                                <div><span><br /></span></div>
                                <div><span>
                                    <hr />
                                  </span></div>
                                <div><br /></div>
                                <div><br /></div>
                                <div><span><b>HARDWARE:</b></span></div>
                                <div><span><br /><br /></span></div>
                                <div><span>
                                    <div style="display:block;text-align:left"><a href="/avr-guide/spi/ATmega%20-%20SPI.JPG?attredirects=0" imageanchor="1">
                                        <img border="0" src="/avr-guide/spi/ATmega%20-%20SPI.JPG" /></a></div>
                                  </span></div>
                                <div><span>
                                    <font face="'courier new', monospace"><i>Figure 1: SPI Pinouts</i></font>
                                  </span></div>
                                <div><span><br /></span></div>
                                <div><span><br /></span></div>
                                <div>
                                  <div><span><span>    SPI uses 4 pins,  A system clock (SCK), a Master Output Slave Input (MOSI), a Master Input Slave Output (MISO) and a Slave Select (SS).  These pins have many other commonly used names:</span><br /></span></div>
                                  <div><span><span><br /></span></span></div>
                                  <div><span><span><br /></span></span></div>
                                  <div><span><span>
                                        <table border="1" bordercolor="#888888" cellspacing="0" style="margin:0px;border-collapse:collapse;border-color:rgb(136,136,136);border-width:1px">
                                          <tbody>
                                            <tr>
                                              <td style="vertical-align:top;width:70px;height:15px"> <b>NAME</b></td>
                                              <td style="vertical-align:top;width:227px;height:15px"><b> ALTERNATE NAMES</b></td>
                                            </tr>
                                            <tr>
                                              <td style="vertical-align:top;width:70px;height:15px"> SCK</td>
                                              <td style="vertical-align:top;width:227px;height:15px"> CLK</td>
                                            </tr>
                                            <tr>
                                              <td style="vertical-align:top;width:70px;height:15px"> MISO</td>
                                              <td style="vertical-align:top;width:227px;height:15px"> SOMI, SDO, DO, SO</td>
                                            </tr>
                                            <tr>
                                              <td style="vertical-align:top;width:70px;height:15px"> MOSI</td>
                                              <td style="vertical-align:top;width:227px;height:15px"> SIMO, SDI, DI, SI</td>
                                            </tr>
                                            <tr>
                                              <td style="vertical-align:top;width:70px;height:16px"> SS</td>
                                              <td style="vertical-align:top;width:227px;height:16px"> CS, CSB, CSN, STE</td>
                                            </tr>
                                          </tbody>
                                        </table>
                                        <font face="'courier new', monospace"><i>Table 1: Alternate SPI pin names</i></font>
                                      </span></span></div>
                                </div>
                                <div><span><span>
                                      <font face="'courier new', monospace"><br /></font>
                                    </span></span></div>
                                <div><span><span>
                                      <font face="'courier new', monospace"><br /></font>
                                    </span></span></div>
                                <div><span>    Because each slave device needs a dedicated SS line, you require <font color="#0000ff">3 + #_of_Slave_Devices </font>pins in order to operate a multi slave buss.</span><br /></div>
                                <div><br /></div>
                                <div><span>    No additional hardware is required in order to run the SPI, no pullup resistors (like I2C), no end cap resistors, and no capacitors.</span><br /></div>
                                <div><br /></div>
                                <div><br /></div>
                                <div>
                                  <div style="display:block;text-align:left"><a href="/avr-guide/spi/SPI%20-%20Single%20Slaves.JPG?attredirects=0" imageanchor="1">
                                      <img border="0" src="/avr-guide/spi/SPI%20-%20Single%20Slaves.JPG" /></a></div>
                                </div>
                                <div><i>
                                    <font face="'courier new', monospace">Figure 2: Single Slave</font>
                                  </i></div>
                                <div><span><br /></span></div>
                                <div><span><br /></span></div>
                                <div><span><span>    </span>Note one thing, if you use a single slave, you could save yourself a pin by hooking up the SS pin on the slave to GND and the SS on the master to VCC.<br /></span></div>
                                <div><span><br /></span></div>
                                <div><span><br /></span></div>
                                <div>
                                  <div style="display:block;text-align:left"><a href="/avr-guide/spi/SPI%20-%20Multi%20Slaves.JPG?attredirects=0" imageanchor="1">
                                      <img border="0" src="/avr-guide/spi/SPI%20-%20Multi%20Slaves.JPG" /></a></div>
                                </div>
                                <div><span>
                                    <font face="'courier new', monospace"><i>Figure 3: Multiple Slaves</i></font>
                                  </span></div>
                                <div><span><br /></span></div>
                                <div><br /></div>
                                <div><span>
                                    <hr /><br />
                                  </span></div>
                                <div><span><br /></span></div>
                                <div><span><b>THEORY OF OPERATION:</b></span></div>
                                <div><br /></div>
                                <div><br /></div>
                                <div>
                                  <div style="display:block;text-align:left"><a href="/avr-guide/spi/SPI%20-%20Block%20Diagram.JPG?attredirects=0" imageanchor="1">
                                      <img border="0" src="/avr-guide/spi/SPI%20-%20Block%20Diagram.JPG" /></a></div><i>
                                    <font face="'courier new', monospace">Figure 4: SPI Communication Block Diagram</font>
                                  </i>
                                </div>
                                <div><br /></div>
                                <div><br /></div>
                                <div><span><span>    The master generates the clock for the entire system and, is responsible for choosing which slave it wants to talk to.  Setting the CS line LOW(GND) for the selected device will select it as the source device.  The clock speed should be set to less then or equal to maximum speed of the slowest slave on your buss.  When the clock pulses the Slave will read the state of the MOSI pin and the Master will read the state of the MISO pin.  The AVR uses an 8 bit shift register, this means that after 8 pulses of the clock the 8 bit Master and Slave have both exchanged a bite of data.</span></span></div>
                                <div><span><span><br /><br /><i>Shift Register:</i><br /><br /></span></span></div>
                                <div><span>    </span>The previously mentioned shift register is a bit crazy.  Lets say we are transmitting from the Master to the Slave.  Each clock cycle the register will be shifted to the left by one in both the Master and the Slave.  The most significant bit (MSB or 7 bit) of the Master will be pushed to the least significant bit (LSB or 0 bit) of the Slave (MOSI line on Figure 4) and, the Slaves MSB will be pushed to the Masters LSB (MISO line on Figure 4).   So after 8 of these exchanges the contents of both registers will be exchanged with each other.<br /></div>
                                <div><span><span><br /></span></span></div>
                                <div><span><br /><i>Clock Polarity and Clock Phase:</i><br /><br />    It can't be as simple as setting the clock speed can it?  Well you'r right.  We also have to setup the SPI mode.  The mode consists of 2 settings the Clock Polarity and Clock Phase:</span><br /></div>
                                <div><span><br /></span></div>
                                <div><span><br /></span></div>
                                <div><span>
                                    <table border="1" bordercolor="#888888" cellspacing="0" style="border-collapse:collapse;border-color:rgb(136,136,136);border-width:1px">
                                      <tbody>
                                        <tr>
                                          <td style="width:60px"> <b>Mode</b></td>
                                          <td style="width:60px"><b> CPOL </b></td>
                                          <td style="width:60px"><b> CPHA</b></td>
                                        </tr>
                                        <tr>
                                          <td style="text-align:center;width:60px"> 0</td>
                                          <td style="text-align:center;width:60px"> 0</td>
                                          <td style="text-align:center;width:60px"> 0</td>
                                        </tr>
                                        <tr>
                                          <td style="text-align:center;width:60px"> 1</td>
                                          <td style="text-align:center;width:60px"> 0</td>
                                          <td style="text-align:center;width:60px"> 1</td>
                                        </tr>
                                        <tr>
                                          <td style="text-align:center;width:60px"> 2</td>
                                          <td style="text-align:center;width:60px"> 1</td>
                                          <td style="text-align:center;width:60px"> 0</td>
                                        </tr>
                                        <tr>
                                          <td style="text-align:center;width:60px"> 3</td>
                                          <td style="text-align:center;width:60px"> 1</td>
                                          <td style="text-align:center;width:60px"> 1</td>
                                        </tr>
                                      </tbody>
                                    </table>
                                    <font face="'courier new', monospace"><i>Table 2: SPI Modes</i></font>
                                  </span></div>
                                <div><span><span><br /></span></span></div>
                                <div><span><span><br /></span></span></div>
                                <div><span><span><span>    So, what do these modes mean?  </span></span></span></div>
                                <div><span><span><span><br /></span></span></span></div>
                                <div><span><span><span><span>    </span>The Clock Polarity decides what whether the data is sent on rising edge or the falling edge.  If CPOL is set to LOW(0) data is sent/received on the Rising Edge and the status of the pins updated(for the next read) on the Falling Edge.  If CPOL is set to HIGH(1) data is sent/received on the Falling Edge and the status of the pins is updated(for the next read) on the Rising Edge.</span><br /></span></span></div>
                                <div><span><span><span><br /></span></span></span></div>
                                <div><span><span><span><span>    The Clock Phase decides when to read the data.  If CPHA is set to LOW(0) data will be reed on the leading edge of the clock.  If CPHA is set to HIGH(1) data will be reed on the trailing edge of the clock.</span><br /></span></span></span></div>
                                <div><span><span><span><span><br /></span></span></span></span></div>
                                <div><span><span><span><span><br />
                                          <div style="display:block;text-align:left"><a href="/avr-guide/spi/SPI%20-%20Timing.JPG?attredirects=0" imageanchor="1">
                                              <img border="0" src="/avr-guide/spi/SPI%20-%20Timing.JPG" /></a></div>
                                        </span></span></span><span><span><span>
                                          <font face="'courier new', monospace"><i>Figure 5: SPI Timing Diagram</i></font>
                                        </span></span></span></span></div>
                                <div><span><span><span><span><br /></span></span></span></span></div>
                                <div><span><span><span><span><br /></span></span></span></span></div>
                                <div>
                                  <table border="1" bordercolor="#888888" cellspacing="0" style="margin:0px;border-color:rgb(136,136,136);border-width:1px;border-collapse:collapse">
                                    <tbody>
                                      <tr>
                                        <td style="vertical-align:top;text-align:center;width:59px;height:15px"> </td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>7 bit </b></td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>6 bit </b></td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>5 bit </b></td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>4 bit </b></td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>3 bit </b></td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>2 bit </b></td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>1 bit </b></td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>0 bit </b></td>
                                      </tr>
                                      <tr>
                                        <td style="vertical-align:top;text-align:center;height:15px"><b>SPCR</b></td>
                                        <td style="vertical-align:top;text-align:center">SPIE</td>
                                        <td style="vertical-align:top;text-align:center">SPE </td>
                                        <td style="vertical-align:top;text-align:center">DORD </td>
                                        <td style="vertical-align:top;text-align:center"><span style="background-color:rgb(255,255,255)">MSTR </span></td>
                                        <td style="vertical-align:top;text-align:center">CPOL </td>
                                        <td style="vertical-align:top;text-align:center">CPHA </td>
                                        <td style="vertical-align:top;text-align:center">SPR1 </td>
                                        <td style="vertical-align:top;text-align:center">SPR0 </td>
                                      </tr>
                                    </tbody>
                                  </table><i style="font-family:courier new,monospace">SPI Control Register</i>
                                </div>
                                <div><br /></div>
                                <div><br /></div>
                                <blockquote style="margin:0pt 0pt 0pt 40px;border:medium none;padding:0px">
                                  <div>
                                    <table border="1" bordercolor="#888888" cellspacing="0" style="margin:0px;border-collapse:collapse;border-color:rgb(136,136,136);border-width:1px">
                                      <tbody>
                                        <tr>
                                          <td style="vertical-align:top;width:60px"> <b>Mode</b></td>
                                          <td style="vertical-align:top;width:60px"><b> CPOL </b></td>
                                          <td style="vertical-align:top;width:60px"><b> CPHA</b></td>
                                        </tr>
                                        <tr>
                                          <td style="vertical-align:top;text-align:center;width:60px"> 0</td>
                                          <td style="vertical-align:top;text-align:center;width:60px"> 0</td>
                                          <td style="vertical-align:top;text-align:center;width:60px"> 0</td>
                                        </tr>
                                        <tr>
                                          <td style="vertical-align:top;text-align:center;width:60px"> 1</td>
                                          <td style="vertical-align:top;text-align:center;width:60px"> 0</td>
                                          <td style="vertical-align:top;text-align:center;width:60px"> 1</td>
                                        </tr>
                                        <tr>
                                          <td style="vertical-align:top;text-align:center;width:60px"> 2</td>
                                          <td style="vertical-align:top;text-align:center;width:60px"> 1</td>
                                          <td style="vertical-align:top;text-align:center;width:60px"> 0</td>
                                        </tr>
                                        <tr>
                                          <td style="vertical-align:top;text-align:center;width:60px"> 3</td>
                                          <td style="vertical-align:top;text-align:center;width:60px"> 1</td>
                                          <td style="vertical-align:top;text-align:center;width:60px"> 1</td>
                                        </tr>
                                      </tbody>
                                    </table>
                                  </div>
                                </blockquote>
                                <blockquote style="margin:0pt 0pt 0pt 40px;border:medium none;padding:0px">
                                  <div>
                                    <font face="'courier new', monospace"><i>Table 2: SPI Modes</i></font>
                                  </div>
                                </blockquote>
                                <div><br /></div>
                                <div><br /></div>
                                <div>
                                  <table border="1" bordercolor="#888888" cellspacing="0" style="margin:0px;border-color:rgb(136,136,136);border-width:1px;border-collapse:collapse">
                                    <tbody>
                                      <tr>
                                        <td style="vertical-align:top;text-align:center;width:59px;height:15px"> </td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>7 bit </b></td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>6 bit </b></td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>5 bit </b></td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>4 bit </b></td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>3 bit </b></td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>2 bit </b></td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>1 bit </b></td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>0 bit </b></td>
                                      </tr>
                                      <tr>
                                        <td style="vertical-align:top;text-align:center;height:15px"><b>SPSR</b></td>
                                        <td style="vertical-align:top;text-align:center">SPIF</td>
                                        <td style="vertical-align:top;text-align:center">WCOL </td>
                                        <td style="vertical-align:top;text-align:center;color:rgb(204,204,204)"><span style="background-color:rgb(238,238,238)">- </span></td>
                                        <td style="vertical-align:top;text-align:center">
                                          <font color="#cccccc" style="background-color:rgb(238,238,238)">- </font>
                                        </td>
                                        <td style="vertical-align:top;text-align:center"><span style="background-color:rgb(238,238,238)">
                                            <font color="#cccccc">- </font>
                                          </span></td>
                                        <td style="vertical-align:top;text-align:center"><span style="background-color:rgb(238,238,238)">
                                            <font color="#cccccc">- </font>
                                          </span></td>
                                        <td style="vertical-align:top;text-align:center">
                                          <font color="#cccccc" style="background-color:rgb(238,238,238)">- </font>
                                        </td>
                                        <td style="vertical-align:top;text-align:center">SPI2X </td>
                                      </tr>
                                    </tbody>
                                  </table><i style="font-family:courier new,monospace">SPI Status Register</i>
                                </div>
                                <div><br /></div>
                                <div><br /></div>
                                <blockquote style="margin:0pt 0pt 0pt 40px;border:medium none;padding:0px">
                                  <div>
                                    <table border="1" bordercolor="#888888" cellspacing="0" style="border-collapse:collapse;border-color:rgb(136,136,136);border-width:1px">
                                      <tbody>
                                        <tr>
                                          <td style="width:52px;height:15px"><b> SPI2X</b></td>
                                          <td style="width:52px;height:15px"><b> SPR1 </b></td>
                                          <td style="width:52px;height:15px"><b> SPR0 </b></td>
                                          <td style="width:123px;height:15px"><b> SCK Frequency</b></td>
                                        </tr>
                                        <tr>
                                          <td style="text-align:center;width:52px;height:15px"> 0</td>
                                          <td style="text-align:center;width:52px;height:15px"> 0 </td>
                                          <td style="text-align:center;width:52px;height:15px"> 0</td>
                                          <td style="width:123px;height:15px"> Clock / 4</td>
                                        </tr>
                                        <tr>
                                          <td style="text-align:center;width:52px;height:15px"> 0</td>
                                          <td style="text-align:center;width:52px;height:15px"> 0</td>
                                          <td style="text-align:center;width:52px;height:15px"> 1 </td>
                                          <td style="width:123px;height:15px"> Clock / 16</td>
                                        </tr>
                                        <tr>
                                          <td style="text-align:center;width:52px;height:15px"> 0</td>
                                          <td style="text-align:center;width:52px;height:15px"> 1</td>
                                          <td style="text-align:center;width:52px;height:15px"> 0 </td>
                                          <td style="width:123px;height:15px"> Clock / 64</td>
                                        </tr>
                                        <tr>
                                          <td style="text-align:center;width:52px;height:15px"> 0</td>
                                          <td style="text-align:center;width:52px;height:15px"> 1</td>
                                          <td style="text-align:center;width:52px;height:15px"> 1 </td>
                                          <td style="width:123px;height:15px"> Clock / 128</td>
                                        </tr>
                                        <tr>
                                          <td style="text-align:center;width:52px;height:15px"> 1</td>
                                          <td style="text-align:center;width:52px;height:15px"> 0 </td>
                                          <td style="text-align:center;width:52px;height:15px"> 0 </td>
                                          <td style="width:123px;height:15px"> Clock / 2</td>
                                        </tr>
                                        <tr>
                                          <td style="text-align:center;width:52px;height:15px"> 1</td>
                                          <td style="text-align:center;width:52px;height:15px"> 0 </td>
                                          <td style="text-align:center;width:52px;height:15px"> 1 </td>
                                          <td style="width:123px;height:15px"> Clock / 8</td>
                                        </tr>
                                        <tr>
                                          <td style="text-align:center;width:52px;height:15px"> 1</td>
                                          <td style="text-align:center;width:52px;height:15px"> 1 </td>
                                          <td style="text-align:center;width:52px;height:15px"> 0</td>
                                          <td style="width:123px;height:15px"> Clock / 32</td>
                                        </tr>
                                        <tr>
                                          <td style="text-align:center;width:52px;height:15px"> 1</td>
                                          <td style="text-align:center;width:52px;height:15px"> 1</td>
                                          <td style="text-align:center;width:52px;height:15px"> 1</td>
                                          <td style="width:123px;height:15px"> Clock / 64</td>
                                        </tr>
                                      </tbody>
                                    </table>
                                  </div>
                                </blockquote>
                                <blockquote style="margin:0pt 0pt 0pt 40px;border:medium none;padding:0px">
                                  <div><i>
                                      <font face="'courier new', monospace">System Clock Division Factor</font>
                                    </i></div>
                                </blockquote>
                                <div><br /></div>
                                <div><br /></div>
                                <div>
                                  <table border="1" bordercolor="#888888" cellspacing="0" style="margin:0px;border-color:rgb(136,136,136);border-width:1px;border-collapse:collapse">
                                    <tbody>
                                      <tr>
                                        <td style="vertical-align:top;text-align:center;width:59px;height:15px"> </td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>7 bit </b></td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>6 bit </b></td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>5 bit </b></td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>4 bit </b></td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>3 bit </b></td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>2 bit </b></td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>1 bit </b></td>
                                        <td style="vertical-align:top;text-align:center;width:59px"><b>0 bit </b></td>
                                      </tr>
                                      <tr>
                                        <td style="vertical-align:top;text-align:center;height:15px"><b>SPDR</b></td>
                                        <td style="vertical-align:top;text-align:center">MSB</td>
                                        <td style="vertical-align:top;text-align:center"> </td>
                                        <td style="vertical-align:top;text-align:center"> </td>
                                        <td style="vertical-align:top;text-align:center;color:rgb(153,153,153)"><span style="background-color:rgb(255,255,255)"> </span></td>
                                        <td style="vertical-align:top;text-align:center"> </td>
                                        <td style="vertical-align:top;text-align:center"> </td>
                                        <td style="vertical-align:top;text-align:center"> </td>
                                        <td style="vertical-align:top;text-align:center">LSB </td>
                                      </tr>
                                    </tbody>
                                  </table><i style="font-family:courier new,monospace">SPI Data Register</i>
                                </div>
                                <div><br /></div>
                                <div><br /></div>
                                <div><span>    Setting the SPE bit within the SPCR register enables SPI. </span> </div>
                                <div><br /></div>
                                <div><span>    </span>Setting the SPIE bit HIGH (1) enables the SPI interrupt.</div>
                                <div><br /></div>
                                <div><span>    </span>The DORD bit within the SPCR register controls the direction of the transmission.  The default is LOW(0) will transmits MSB first and LSB last, if the bit is SET(1) will transmit the LSB first and the MSB last.</div>
                                <div><br /></div>
                                <div><span>    The MSTR bit within the SPCR register tells the AVR whether it is a master or a slave.  If the SS pin is set as an input while the AVR is in Master Mode and, the pin is driven LOW (GND), the MSTR bit will be cleared (0) and the user must set the bit HIGH(1) to re-establish Master mode.</span><br /></div>
                                <div><span><br /><span>    </span>The SPIF bit within the SPSR sets HIGH(1) whenever data transmission is complete even if interrupts are not enabled.  This is useful because we could check the status of the bit in order to figure out if it is safe to write the the SPDR register.<br /><br /></span></div>
                                <div><span><span>    Writing to the SPDR register causes data to be loaded into the shift register and automatically triggers the AVR to transmit.  Reading from the SPDR register causes the data to be read from the receive shift register.</span></span></div>
                                <div><span><span><br /></span></span></div>
                                <div><span><span><span>    The WCOL bit within the SPSR register will be set HIGH(1) if you attempt to write data into the SPDR register during data transmission.  WCOL will be cleared (0) when the SPDR is reed. </span> </span><br /></span></div>
                                <div><span><br /></span></div>
                                <div><br /></div>
                                <div>
                                  <hr /><br />
                                </div>
                                <div><br /></div>
                                <div>
                                  <font face="'courier new', monospace" size="3"><b>SOFTWARE:</b></font>
                                </div>
                                <div><br /></div>
                                <div><span>    </span><br /></div>
                                <div><span><span>    It's not very often when the ATmega8 and ATmega168/328 use the same registers, but guess what the SPI is the same.  I love it because it saves me from writing another tutorial.</span><br /></span></div>
                                <div><br /></div>
                                <div><br /></div>
                                <div><i>ATmega8 &amp; ATmega168/328 Code:</i></div>
                                <div></div>
                                <div class="sites-codeblock sites-codesnippet-block">
                                  <div><code>// this program enables SPI communication and</code></div>
                                  <div><code>// Sets the AVR into Master mode</code></div>
                                  <div><code><br /></code></div>
                                  <div><br /></div>
                                  <div><code>#include &lt;avr/io.h&gt;</code></div>
                                  <div>
                                    <font color="#006000" face="monospace"><br /></font>
                                  </div>
                                  <div><br /></div>
                                  <div><code>int main (void)</code></div>
                                  <div><code>{</code></div>
                                  <div><code><span><span>    char data;</span><br /></span></code></div>
                                  <div><code><span><br /></span></code></div>
                                  <div><code><span>    DDRB |= (1&lt;&lt;2)|(1&lt;&lt;3)|(1&lt;&lt;5);<span>    // SCK, MOSI and SS as outputs</span></span></code></div>
                                  <div><code><span><span><span>    DDRB &amp;= ~(1&lt;&lt;4);<span>    <span>    <span>    <span>   <span>  </span>// MISO as input</span></span></span></span></span></span></span></code></div>
                                  <div><code><span><span><span><span><span><span><span><br /></span></span></span></span></span></span></span></code></div>
                                  <div><code><span><span><span><span><span><span><span><span>    SPCR |= (1&lt;&lt;MSTR);<span>    <span>    <span>    <span>   // Set as Master</span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                  <div><code><span><span><span><span><span><span><span><span><span><span><span><span><span>    SPCR |= (1&lt;&lt;SPR0)|(1&lt;&lt;SPR1);<span>     // divided clock by 128</span></span><br /></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                  <div><code><span><span><span><span><span><span><span><span><span>    SPCR |= (1&lt;&lt;SPE);<span>    <span>    <span>    <span>    // Enable SPI</span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                  <div><code><span><span><span><span><span><span><span><span><span><span><span><span><span><span>    </span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                  <div><code><span><span><span><span><span><span><span><span><span><span><span><span><span><span>    while(1)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                  <div><code><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>    {</span><br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                  <div><code><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>    <span>    SPDR = data;<span>    <span>    <span>    <span>     // send the data</span></span></span></span></span></span><br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                  <div><code><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>    <span>    while(!(SPSR &amp; (1&lt;&lt;SPIF)));  // wait until transmission is complete<br /><br /><span>    </span><span>    </span>// if you have multiple slaves, this is where you want to switch<br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                  <div></div>
                                  <div><code><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>    </span>}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                  <div><code>}</code></div>
                                </div>
                                <div><br /></div>
                                <div><br /></div>
                                <div><span>    Now I shall use my captain obvious powers to say, both of these programs can be used to communicate with each other.</span><br /></div>
                                <div><br /></div>
                                <div><br /></div>
                                <div>
                                  <div><i>ATmega8 &amp; ATmega168/328 Code:</i></div>
                                  <div></div>
                                  <div class="sites-codeblock sites-codesnippet-block" style="background-color:rgb(239,239,239);border:1px solid rgb(211,211,211);display:block;padding:0.5em 0px 0.5em 1em;line-height:13px">
                                    <div><code style="color:rgb(0,96,0)">// this program enables SPI communication and</code></div>
                                    <div><code style="color:rgb(0,96,0)">// Sets the AVR into Slave mode</code></div>
                                    <div><code style="color:rgb(0,96,0)"><br /></code></div>
                                    <div><br /></div>
                                    <div><code style="color:rgb(0,96,0)">#include &lt;avr/io.h&gt;</code></div>
                                    <div>
                                      <font color="#006000" face="monospace"><br /></font>
                                    </div>
                                    <div><br /></div>
                                    <div><code style="color:rgb(0,96,0)">int main (void)</code></div>
                                    <div><code style="color:rgb(0,96,0)">{</code></div>
                                    <div><code style="color:rgb(0,96,0)"><span>    char data;</span><br /></code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><br /></span></code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span>    DDRB &amp;= ~((1&lt;&lt;2)|(1&lt;&lt;3)|(1&lt;&lt;5));<span>   // SCK, MOSI and SS as inputs</span></span><br /></span></code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span>    DDRB |= (1&lt;&lt;4);<span>    <span>    <span>    <span>    <span>    </span>// MISO as output</span></span></span></span></span></span></code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><br /></span></span></span></span></span></span></code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span>    SPCR &amp;= ~(1&lt;&lt;MSTR);<span>    <span>    <span>    <span>    // Set as slave </span></span></span></span></span></span></span></span></span></span></span></code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span>    SPCR |= (1&lt;&lt;SPR0)|(1&lt;&lt;SPR1);<span>    <span>   // divide clock by 128</span></span></span></span></span></span></span></span><br /></span></code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span>    SPCR |= (1&lt;&lt;SPE);<span>    <span>    <span>    <span>    <span>  // Enable SPI</span></span></span></span></span></span><br /></span></span></span></span></span></span></span></span></span></code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>    while(1)</span><br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>    {</span><br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>    <span>    while(!(SPSR &amp; (1&lt;&lt;SPIF)));<span>    // wait until all data is received</span></span></span><br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>    <span>    data = SPDR;<span>    <span>    <span>    <span>    <span>   // hurray, we now have our data</span></span></span></span></span></span></span><br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>    }</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                    <div><code style="color:rgb(0,96,0)">}</code></div>
                                  </div>
                                </div>
                                <div><br /></div>
                                <div><br /></div>
                                <div><span>    Alternately, we could do the same BUT with using interrupts.</span><br /></div>
                                <div><span><br /></span></div>
                                <div><br /></div>
                                <div><span>
                                    <div><i>ATmega8 &amp; ATmega168/328 Code:</i></div>
                                    <div></div>
                                    <div class="sites-codeblock sites-codesnippet-block" style="border:1px solid rgb(211,211,211);display:block;padding:0.5em 0px 0.5em 1em;background-color:rgb(239,239,239)">
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)">// this program enables SPI communication and</code></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)">// Sets the AVR into Master mode using interrupts</code></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)"><br /></code></div>
                                      <div style="line-height:13px"><br /></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)">#include &lt;avr/io.h&gt;</code></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)">#include &lt;avr/interrupt.h&gt;</code></div>
                                      <div style="line-height:13px">
                                        <font color="#006000" face="monospace"><br /></font>
                                      </div>
                                      <div style="line-height:13px">
                                        <font color="#006000" face="monospace">volatile data;</font>
                                      </div>
                                      <div style="line-height:13px"><br /></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)">int main (void)</code></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)">{</code></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)"><span><span>    char blah;</span><br /></span></code></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)"><span><br /></span></code></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)"><span>    DDRB |= (1&lt;&lt;2)|(1&lt;&lt;3)|(1&lt;&lt;5);<span>    // SCK, MOSI and SS as outputs</span></span></code></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)"><span><span><span>    DDRB &amp;= ~(1&lt;&lt;4);<span>    <span>    <span>    <span>   <span>  </span>// MISO as input</span></span></span></span></span></span></span></code></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><br /></span></span></span></span></span></span></span></code></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span>    SPCR |= (1&lt;&lt;MSTR);<span>    <span>    <span>    <span>   // Set as Master</span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span><span><span><span>    SPCR |= (1&lt;&lt;SPR0)|(1&lt;&lt;SPR1);<span>     // divided clock by 128</span></span><br /></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)"><code style="font-size:10pt">    SPCR |= (1&lt;&lt;SPIE);               // Enable SPI </code>
                                        <font color="#006000" face="monospace" style="line-height:13.3333320617676px;font-size:10pt"><span style="line-height:13px">Interrupt</span></font><span><span><span><span><span><span><span><span><span>    </span></span></span></span></span></span></span></span></span></code>
                                      </div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span>    </span>SPCR |= (1&lt;&lt;SPE);<span>    <span>    <span>    <span>    // Enable SPI</span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                      <div><br /></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)"><span>    </span>sei();<span><span><span><span><span><span><span><span><span><span><span><span><span><span>    </span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span>    while(1)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>    {</span><br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>    <span>    if (</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>(SPSR &amp; (1&lt;&lt;SPIF)) &gt; 0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>)</span></span><span>  </span><span>//</span> checks to see if the SPI bit is clear<br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>    <span>    <span>    </span>data=blah;<span>    <span>    <span>    <span>   // send the data</span></span></span></span></span></span><br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                      <div style="line-height:13px">
                                        <font color="#006000" face="monospace"><br /><span>    </span><span>    </span>// if you use multiple slaves, switch slave here.<br /></font>
                                      </div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>    </span>}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)">}</code></div>
                                      <div style="line-height:13px">
                                        <font color="#006000" face="monospace"><br /></font>
                                      </div>
                                      <div style="line-height:13px">
                                        <font color="#006000" face="monospace"><br /></font>
                                      </div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)">ISR (SPI_STC_vect)</code></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)">{</code></div>
                                      <div style="line-height:13px"><code style="color:rgb(0,96,0)"><span>    SPDR = data;</span><br /></code></div>
                                      <div style="line-height:13px">
                                        <font color="#006000" face="monospace">}</font>
                                      </div>
                                    </div>
                                  </span></div>
                                <div><br /></div>
                                <div><br /></div>
                                <div><br /></div>
                                <div>
                                  <div><i>ATmega8 &amp; ATmega168/328 Code:</i></div>
                                  <div></div>
                                  <div class="sites-codeblock sites-codesnippet-block" style="background-color:rgb(239,239,239);border:1px solid rgb(211,211,211);display:block;padding:0.5em 0px 0.5em 1em;line-height:13px">
                                    <div><code style="color:rgb(0,96,0)">// this program enables SPI communication and</code></div>
                                    <div><code style="color:rgb(0,96,0)">// Sets the AVR into Slave mode</code></div>
                                    <div><code style="color:rgb(0,96,0)"><br /></code></div>
                                    <div><br /></div>
                                    <div><code style="color:rgb(0,96,0)">#include &lt;avr/io.h&gt;</code></div>
                                    <div>
                                      <font color="#006000" face="monospace">#include &lt;avr/interrupt.h&gt;</font>
                                    </div>
                                    <div>
                                      <font color="#006000" face="monospace"><br /></font>
                                    </div>
                                    <div>
                                      <font color="#006000" face="monospace">volatile data;</font>
                                    </div>
                                    <div><br /></div>
                                    <div><code style="color:rgb(0,96,0)">int main (void)</code></div>
                                    <div><code style="color:rgb(0,96,0)">{</code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span>    DDRB &amp;= ~((1&lt;&lt;2)|(1&lt;&lt;3)|(1&lt;&lt;5));<span>   // SCK, MOSI and SS as inputs</span></span><br /></span></code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span>    DDRB |= (1&lt;&lt;4);<span>    <span>    <span>    <span>    <span>    </span>// MISO as output</span></span></span></span></span></span></code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><br /></span></span></span></span></span></span></code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span>    SPCR &amp;= ~(1&lt;&lt;MSTR);<span>    <span>    <span>    <span>    // Set as slave </span></span></span></span></span></span></span></span></span></span></span></code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span>    SPCR |= (1&lt;&lt;SPR0)|(1&lt;&lt;SPR1);<span>    <span>   // divide clock by 128</span></span></span></span></span></span></span></span><br /></span></code></div>
                                    <div><code style="color:rgb(0,96,0)"><code>    SPCR |= (1&lt;&lt;SPIE);               <span>  </span>// Enable SPI </code>
                                      <font color="#006000" face="monospace" style="line-height:13.3333320617676px"><span style="line-height:13px">Interrupt</span></font></code>
                                    </div>
                                    <div><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span>    SPCR |= (1&lt;&lt;SPE);<span>    <span>    <span>    <span>    <span>  // Enable SPI</span></span></span></span></span></span><br /></span></span></span></span></span></span></span></span></span></code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>    </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>sei();</code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>    while(1)</span><br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                    <div><code style="color:rgb(0,96,0)"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>    {</span><br /></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></div>
                                    <div><span style="color:rgb(0,96,0);font-family:monospace"><span>    <span>    ;</span></span></span><span style="color:rgb(0,96,0);font-family:monospace"><br /></span></div>
                                    <div><span style="color:rgb(0,96,0);font-family:monospace">    }</span></div>
                                    <div><code style="color:rgb(0,96,0)">}</code></div>
                                    <div><code style="color:rgb(0,96,0)"><br /></code></div>
                                    <div>
                                      <font color="#006000" face="monospace">ISR (SPI_STC_vect)</font>
                                    </div>
                                    <div>
                                      <font color="#006000" face="monospace">{</font>
                                    </div>
                                    <div>
                                      <font color="#006000" face="monospace"><span>    data = SPDR;</span></font>
                                    </div>
                                    <div>
                                      <font color="#006000" face="monospace"><span>    // do something with the received data</span><br /></font>
                                    </div>
                                    <div>
                                      <font color="#006000" face="monospace">}</font>
                                    </div>
                                  </div>
                                </div>
                                <div><br /></div>
                                <div><span><br /></span>
                                  <hr size="2" width="100%" />
                                  <font size="3"><b style="font-family:courier new,monospace"><br /><br />OTHER RESOURCES:</b></font><span><br /><br /><a href="https://ww1.microchip.com/downloads/en/Appnotes/Atmel-2585-Setup-and-Use-of-the-SPI_ApplicationNote_AVR151.pdf" target="_blank" rel="nofollow">AVR151: Setup And Use of The SPI</a><br /></span><a href="http://ww1.microchip.com/downloads/en/Appnotes/doc8057.pdf" target="_blank" rel="nofollow">AVR1309: Using the XMEGA SPI</a><br /><span><a href="https://www.microchip.com/content/dam/mchp/documents/OTH/ApplicationNotes/ApplicationNotes/doc32017.pdf" target="_blank" rel="nofollow">AVR32105: Master and Slave SPI Driver</a><br /><br /><br /></span>
                                  <hr size="2" width="100%" /><span><br /><br /></span>
                                </div>
                                <div><span><span>    Woot, all the episodes of Angel are now on Netflix I love Darla (</span></span>Julie M. Benz).  Google it, I can't do everything for you.</div>
                                <div><br /><br /></div>
                                <div>Cheers</div>
                                <div>Q</div>
                                <div><br /></div>
                                <div><br /></div>
                                <div><br /></div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div id="sites-chrome-footer-wrapper">
            <div id="sites-chrome-footer-wrapper-inside">
              <div id="sites-chrome-footer">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

</html>