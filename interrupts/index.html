<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">

<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="chrome=1" />
  <link rel="shortcut icon" type="image/x-icon" href="//www.google.com/images/icons/product/sites-16.ico" />
  <link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/5acb68/system/app/images/apple-touch-icon.png" type="image/png" />

  <meta name="title" content="INTERRUPTS - QEEWiki" />
  <meta itemprop="name" content="INTERRUPTS - QEEWiki" />
  <meta property="og:title" content="INTERRUPTS - QEEWiki" />
  <meta name="description" content="Q's Electrical Engineering Wiki" />
  <meta itemprop="description" content="Q's Electrical Engineering Wiki" />
  <meta id="meta-tag-description" property="og:description" content="Q's Electrical Engineering Wiki" />
  <style type="text/css">
  </style>
  <link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/5acb68/system/app/themes/simple/standard-css-simple-ltr-ltr.css" />
  <link rel="stylesheet" type="text/css" href="/site/qeewiki/_/rsrc/1601537872000/system/app/css/overlay.css?cb=simple960px70175goog-ws-leftnonethemedefaultstandard" />
  <link rel="stylesheet" type="text/css" href="/site/qeewiki/_/rsrc/1601537872000/system/app/css/camelot/allthemes-view.css" />

  <title>INTERRUPTS - QEEWiki</title>
</head>

<body xmlns="http://www.google.com/ns/jotspot" id="body" class="en">
  <div id="sites-page-toolbar" class="sites-header-divider">
    <div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;">
      <div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div>
    </div>
  </div>
  <div id="sites-chrome-everything-scrollbar">
    <div id="sites-chrome-everything" class="">
      <div id="sites-chrome-page-wrapper" style="direction: ltr">
        <div id="sites-chrome-page-wrapper-inside">
          <div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper">
            <table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0">
              <tr class="sites-header-primary-row" id="sites-chrome-userheader">
                <td id="sites-header-title" class="" role="banner" style="height: 70px">
                  <div class="sites-header-cell-buffer-wrapper">
                    <h2><a href="/avr-guide" dir="ltr" id="sites-chrome-userheader-title">QEEWiki</a></h2>
                  </div>
                </td>
              </tr>
              <tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
                <td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
                </td>
              </tr>
            </table>
          </div>
          <div id="sites-chrome-main-wrapper">
            <div id="sites-chrome-main-wrapper-inside">
              <table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
                <tr>
                  <td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:175px">
                    <div xmlns="http://www.w3.org/1999/xhtml" id="COMP_2bd" class="sites-embed" role="navigation">
                      <h4 class="sites-embed-title">Navigation</h4>
                      <div class="sites-embed-content sites-sidebar-nav">
                        <ul role="navigation" jotId="navList" class="has-expander">
                          <li class="topLevel nav-first ">
                            <div dir="ltr" style="padding-left: 19px;"><a href="https://github.com/chayanforyou" jotId="wuid:gx:3b2a480be041e60" class="sites-navigation-link topLevel">Home</a></div>
                          </li>
                          <li class="topLevel parent " wuid="gx:535b3f3a2562e7ad">
                            <div dir="ltr" style="padding-left: 0px;">
                              <div class="expander"></div><a href="/avr-guide" jotId="wuid:gx:535b3f3a2562e7ad" class="sites-navigation-link topLevel">My Books</a>
                            </div>
                            <ul role="navigation" class="has-expander">
                              <li class="">
                                <div dir="ltr" style="padding-left: 38px;"><a href="/avr-guide" jotId="wuid:gx:5233ae16d3813d0e" class="sites-navigation-link">AVR GUIDE</a></div>
                              </li>
                            </ul>
                          </li>
                          <li class="topLevel ">
                            <div dir="ltr" style="padding-left: 19px;"><a href="/avr-guide" jotId="wuid:gx:9d929f8c6b8e7ca" class="sites-navigation-link topLevel">Usefull Engineering Stuff</a></div>
                          </li>
                        </ul>
                      </div>
                    </div>
                    <div xmlns="http://www.w3.org/1999/xhtml" id="COMP_5818525579565211" class="sites-embed" role="navigation">
                      <h4 class="sites-embed-title">Resources</h4>
                      <div class="sites-embed-content sites-sidebar-nav">
                        <ul role="navigation" jotId="navList" class="has-expander">
                          <li class="topLevel nav-first ">
                            <div dir="ltr" style="padding-left: 19px;"><a href="http://www.sparkfun.com" class="sites-navigation-link topLevel">Sparkfun</a></div>
                          </li>
                          <li class="topLevel ">
                            <div dir="ltr" style="padding-left: 19px;"><a href="http://arduino.cc/en/Reference/HomePage" class="sites-navigation-link topLevel">Arduino Reference</a></div>
                          </li>
                          <li class="topLevel ">
                            <div dir="ltr" style="padding-left: 19px;"><a href="http://www.eevblog.com/" class="sites-navigation-link topLevel">EEVBlog</a></div>
                          </li>
                          <li class="topLevel ">
                            <div dir="ltr" style="padding-left: 19px;"><a href="http://fritzing.org/download/" class="sites-navigation-link topLevel">Fritzing Projects</a></div>
                          </li>
                          <li class="topLevel ">
                            <div dir="ltr" style="padding-left: 19px;"><a href="http://www.adafruit.com/" class="sites-navigation-link topLevel">Ada Fruit</a></div>
                          </li>
                          <li class="topLevel ">
                            <div dir="ltr" style="padding-left: 19px;"><a href="http://www.pololu.com/" class="sites-navigation-link topLevel">Pololu</a></div>
                          </li>
                          <li class="topLevel parent ">
                            <div dir="ltr" style="padding-left: 0px;">
                              <div class="expander"></div><a href="http://www.atmel.com" class="sites-navigation-link topLevel">Atmel</a>
                            </div>
                            <ul role="navigation" class="has-expander">
                              <li class="">
                                <div dir="ltr" style="padding-left: 38px;"><a href="https://ww1.microchip.com/downloads/aemDocuments/documents/MCU08/ProductDocuments/DataSheets/ATmega8A-Data-Sheet-DS40001974B.pdf" class="sites-navigation-link">Atmega8 Datasheet</a></div>
                              </li>
                              <li class="">
                                <div dir="ltr" style="padding-left: 38px;"><a href="https://ww1.microchip.com/downloads/en/DeviceDoc/ATmega48A-PA-88A-PA-168A-PA-328-P-DS-DS40002061B.pdf" class="sites-navigation-link">ATMega168/328 Datasheet</a></div>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </td>
                  <td id="sites-canvas-wrapper">
                    <div id="sites-canvas" role="main">
                      <div id="goog-ws-editor-toolbar-container"> </div>
                      <div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs">
                        <A href="/avr-guide" dir="ltr">My Books</A> &gt; <A href="/avr-guide" dir="ltr">AVR GUIDE</A> &gt; 
                      </div>
                      <h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header"align="left">
                        <span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">INTERRUPTS</span>
                      </h3>
                      <div id="sites-canvas-main" class="sites-canvas-main">
                        <div id="sites-canvas-main-content">
                          <div xmlns="http://www.w3.org/1999/xhtml" class="sites-layout-name-one-column-hf sites-layout-vbox">
                            <div class="sites-layout-tile sites-tile-name-header sites-layout-empty-tile">
                              <div dir="ltr"><br /></div>
                            </div>
                            <div class="sites-layout-tile sites-tile-name-content-1">
                              <div dir="ltr"><span><b style="font-family:courier new,monospace"><span style="font-size:medium">WHAT IS AN INTERRUPT?:</span></b><br /><br />    Programming is sequential by nature and that's all right when we deal with computer programming however, micro controllers interact with the physical world.  The physical world is unpredictable, events happen at random intervals and sometimes they have to be dealt with right away to prevent hardware damage or data loss.   <br /><br /><span>    </span>Say you have a program that bakes cookies and calculates the value of pie. So we write a program that calculates a digit, then checks to see if the cookies are done, and repeats over and over again.  Because each digit takes longer and longer to calculate your cookies will probably come out burned.</span><br /><br /><span>    </span>The good news is that AVR's something called Interrupts, which basically allows you to interrupt the current running code in order to perform another action, and once done resume the function that it interrupted.  So using our previous example, the "cookies are done" interrupt would trigger, dropping us out of the pie digit calculation function and provide us with melty, chewy cookie goodness.<br /><br /><span>    I will cover the basics theory of interrupts in this section, the interrupts that deal with specific system will be covered under those systems (ie. timer interrupts will be covered under the timers section .. etc)<br /><br /><span><br /></span></span>
                                <div><span><span>
                                      <hr />
                                    </span></span></div>
                                <div><span><span><br /><br /><b>
                                        <font face="'courier new', monospace"><span style="font-size:medium">THEORY OF OPERATION:</span></font>
                                      </b><br /><span><span><span><br /></span></span></span></span></span><span>    </span>If you look at the AVR data sheet you will notice a
                                  table to interrupt vectors.  This is basically a priority list, the
                                  lowest number on the list will be executed first.  As you can see the
                                  reset is the highest priority interrupt, and Store Program Memory Ready
                                  is the lowest priority. If the program calls for both at the same time,
                                  the reset is going to win.<br /><span><span><span><span><span><br /><span>    </span>Interrupts are off by default and must be enabled using the sei() function.  They could also be stopped using the cli() function (CLear interrupts).<br /><br />    </span>In order to use interrupts we use the sei() </span></span></span></span><span><span><span><span>function</span></span></span></span><span><span><span><span>, this Enables the Global Interrupt Enable (I-bit) in the Status Register (SREG).</span><span>  </span>When an interrupt occurs, the Global Interrupt Enable (I-bit) in the is Status Register (SREG) is cleared in order to disable other interrupt calls.  The user software can write logic 1 to the I-bit (I in SREG register) to enable nested interrupts(ie to allow other interrupts to interrupt the interrupt). The I-bit is automatically set when the program exits the interrupt routine.</span></span></span>  When the AVR exits from an interrupt, it will always return to the main program and execute one more instruction before any pending interrupt is served.<br /><br /></div>
                                <div><br /></div>
                                <blockquote style="margin:0pt 0pt 0pt 40px;border:medium none;padding:0px">
                                  <div><span style="color:rgb(255,0,0)">Note:</span> main program means main() or any function called by main();  so if main() calls a function deathray(), and an interrupt is called, the interrupt will be executed and the program will jump back to deathray().  If another interrupt is pending, only 1 instruction of deathray() has to be executed before that interrupt can fire.</div>
                                </blockquote>
                                <div>
                                  <div><br /></div>
                                  <div><br /></div>
                                  <div>
                                    <hr />
                                  </div>
                                  <div><br /><br /><b style="font-family:courier new,monospace"><span style="font-size:medium">SOFTWARE:</span></b><br /><br /><span><span>    Lets just jump into it and explain later:<br /></span></span><span><span><br /></span></span></div>
                                  <div><span><span><i>ATmega8 &amp; ATmega168/328 Code:</i><br /></span></span>
                                    <div class="sites-codeblock sites-codesnippet-block"><span><span><code>#include &lt;avr/io.h&gt;</code><br /><code>#include &lt;avr/interrupt.h&gt;</code><br /><br /><br /><br /><code>int main(void)</code><br /><code>{</code><span><br /><code>    </code></span><code>sei();</code><span><code>    </code></span><span><code>     </code></span><code>//enable interrupts</code><br /><span><br /><code>    </code></span><code>while (1)</code><span><code>    </code></span><span><code>  </code></span><code>// main loop</code><br /><span><code>    </code></span><code>{</code><br /><span><code>    </code></span><span><code>    </code></span><code>;</code><br /><span><code>    </code></span><code>}</code><br /></span></span><code>}</code><br /><br /><br /><br /><code>ISR (INT0_vect)<span>    </span></code><code>// INT0 interrupt function</code><br /><code>{</code><br /><span><code>    </code></span><code>/* enter code to execute here</code><code> */<br />}<br /><br /><br /></code><br /><code>ISR (BADISR_vect)</code><span><code>  </code></span><code>// special function, to execute if a bad interrupt is called</code><br /><code>{</code><br /><span><code>    </code></span><code>/* enter code to execute here */</code><br /><code>}</code></div><br /><br /><span>    </span>Lets examine the code, io.h is always included in order to setup your special registers.  interrupt.h is included because it needed to run your interrupts stuff.  sei() starts our interrupt (stands for SEt Interrupt).  ISR (***_vect) is the function that is called when the *** vector is called.  *** is basicly any name found on the table in the interrupt secion of the datasheet (substitute spaces with understores "_").  BADISR is not on the list, however, it has a neat function, ... in the event that your code calls a vector that does not exist it will execute this code.<br /><br /><br /><br /><i>Interrupt Disable</i>:<br /><br /><span><span>    </span>As mentioned above interrupts can be enabled and disabled as needed.  In some cases you might have a chunk of code which cannot be interrupted such as a time sensitive output signal to another device.<br /><br /></span>
                                  </div>
                                  <div><span><br /><i>ATmega8 &amp; ATmega168/328 Code:</i><br /></span>
                                    <div class="sites-codeblock sites-codesnippet-block"><span><span><code>#include &lt;avr/io.h&gt;</code><br /><br /></span></span><span><span><code>#include &lt;avr/interrupt.h&gt;</code><br /><br /><br /><br /><code>int main(void)</code><br /><code>{</code><span><br /><code>    </code></span><code>sei();</code><span><code>    </code></span><span><code>     </code></span><code>//enable interrupts</code><br /><span><br /><code>    </code></span><code>while (1)</code><span><code>    </code></span><span><code>  </code></span><code>// main loop</code><br /><span><code>    </code></span><code>{</code><br /><span><br /><span><span><code>    </code></span><span><code>    /* code here can be interrupted */</code></span></span><br /><br /><span><code>    </code></span><span><code>    </code></span><code>cli();</code><span><code>     </code></span><code>// turn off interrupts</code><br /><span><br /><code>    </code></span><span><code>    </code></span><code>/* all code executed here cannot be interrupted */</code><br /><br /><span><code>    </code></span><span><code>    </code></span><code>sei();</code><span><code>     </code></span><code>// enable interrupt</code><br /><br /><span><code>    </code></span><span><code>    </code></span><code>/* code here can be interrupted */</code><br /><br /><code>    </code></span><span><code>    </code></span><code>;</code><br /><span><code>    </code></span><code>}</code><br /></span></span><code>}</code><br /><br /><br /><br /><code>ISR (INT0_vect)</code><span><code>    </code></span><code>// INT0 interrupt function</code><br /><code>{</code><br /><span><code>    </code></span><code>/* enter code to execute here</code><code> */</code><br /><code>}</code><br /><br /><br /><br /><code>ISR (BADISR_vect)</code><span><code>  </code></span><code>// special function, to execute if a bad interrupt is called</code><br /><code>{</code><br /><span><code>    </code></span><code>/* enter code to execute here */</code><br /><code>}</code></div><br />
                                  </div>
                                  <div><br /></div>
                                  <div><br /></div>
                                  <div>
                                    <font face="'courier new', monospace"><span style="font-size:medium"><i>Passing Variables Into ISP():</i></span></font>
                                  </div>
                                  <div><br /></div>
                                  <div><br /></div>
                                  <div><i>ATmega8 &amp; ATmega168/328 Code:</i></div>
                                  <div></div>
                                  <div></div>
                                  <div class="sites-codeblock sites-codesnippet-block">
                                    <div><span style="line-height:13px"><span><span><code>#include &lt;avr/io.h&gt;</code>
                                            <font color="#006000" face="monospace"><br /></font>
                                          </span></span></span></div>
                                    <div><span style="line-height:13px"><span><span><br /></span></span></span></div>
                                    <div><span style="line-height:13px"><span><span><code>#include &lt;avr/interrupt.h&gt;</code><br /><br /><br /></span></span></span></div>
                                    <div><span style="line-height:13px"><span><span><code>volatile uint8_t test;</code></span></span></span></div>
                                    <div><span style="line-height:13px"><span><span><br /><br /><code>int main(void)</code><br /><code>{</code><span><br /><code>    </code></span><code>sei();</code><span><code>    </code></span><span><code>     </code></span><code>//enable interrupts</code><br /><span><br /><code>    </code></span><code>while (1)</code><span><code>    </code></span><span><code>  </code></span><code>// main loop</code><br /><span><code>    </code></span><code>{</code><br /><span><br /><span><span><code>    </code></span><span><code>    /* code here can be interrupted */</code></span></span><br /><br /><span><code>    </code></span><span><code>    </code></span><code>cli();</code><span><code>     </code></span><code>// turn off interrupts</code><br /><span><br /><code>    </code></span><span><code>    </code></span><code>/* all code executed here cannot be interrupted */</code><br /><br /><span><code>    </code></span><span><code>    </code></span><code>sei();</code><span><code>     </code></span><code>// enable interrupt</code><br /><br /><span><code>    </code></span><span><code>    </code></span><code>/* code here can be interrupted */</code><br /><br /><code>    </code></span><span><code>    </code></span><code>;</code><br /><span><code>    </code></span><code>}</code><br /></span></span><code>}</code><br /><br /><br /><br /><code>ISR (INT0_vect)</code><span><code>    </code></span><code>// INT0 interrupt function</code><br /><code>{</code><br /><span><code>    </code></span><code>/* enter code to execute here</code><code> */</code><br /><code>}</code><br /><br /><br /><br /><code>ISR (BADISR_vect)</code><span><code>  </code></span><code>// special function, to execute if a bad interrupt is called</code><br /><code>{</code><br /><span><code>    </code></span><code>/* enter code to execute here */</code><br /><code>}</code></span></div>
                                  </div>
                                  <div></div><br />
                                  <div><br /></div>
                                  <div><span>    Because there is no way to pass data to ISR other then a global variable it is a great idea to make the variable "volatile".  Basically, this will prevent the compiler from optimizing the code in such a way as to make the variable no update properly by the ISR.  If you like to know more, please read </span><b><a href="#">Do you volatile? should you?  </a></b><a href="http://www.linuxfordevices.com/c/a/Linux-For-Devices-Articles/Do-you-volatile-Should-you/" rel="nofollow">by Dr. Kevin P. Dankwardt</a>.</div>
                                  <div><br /><br /></div>
                                  <div><span>    That's it for the general stuff.</span><br /></div>
                                  <div><span><br /><br /></span></div>
                                  <div><span>Cheers</span></div>
                                  <div>Q</div>
                                </div>
                                <div><br /></div>
                                <div><br /></div>
                                <div><br /></div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div id="sites-chrome-footer-wrapper">
            <div id="sites-chrome-footer-wrapper-inside">
              <div id="sites-chrome-footer">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

</html>