<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { /*

Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/
(function(){function e(g){this.t={};this.tick=function(h,k,f){this.t[h]=[void 0!=f?f:(new Date).getTime(),k];if(void 0==f)try{window.console.timeStamp("CSI/"+h)}catch(m){}};this.getStartTickTime=function(){return this.t.start[0]};this.tick("start",null,g)}var a;if(window.performance)var d=(a=window.performance.timing)&&a.responseStart;var l=0<d?new e(d):new e;window.jstiming={Timer:e,load:l};if(a){var b=a.navigationStart;0<b&&d>=b&&(window.jstiming.srt=d-b)}if(a){var c=window.jstiming.load;0<b&&d>=
b&&(c.tick("_wtsrt",void 0,b),c.tick("wtsrt_","_wtsrt",d),c.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),c&&0<b&&(c.tick("_tbnd",void 0,window.chrome.csi().startE),c.tick("tbnd_","_tbnd",b))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,c&&0<b&&(c.tick("_tbnd",void 0,window.external.startE),c.tick("tbnd_","_tbnd",b))),a&&(window.jstiming.pt=a)}catch(g){}})(); })()
</script>
<link rel="shortcut icon" type="image/x-icon" href="//www.google.com/images/icons/product/sites-16.ico" />
<link rel="apple-touch-icon" href="https://ssl.gstatic.com/sites/p/cc68c3/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { function d(a){return document.getElementById(a)}window.byId=d;function g(a){return a.replace(/^\s+|\s+$/g,"")}window.trim=g;var h=[],k=0;window.JOT_addListener=function(a,b,c){var f=new String(k++);a={eventName:a,handler:b,compId:c,key:f};h.push(a);return f};window.JOT_removeListenerByKey=function(a){for(var b=0;b<h.length;b++)if(h[b].key==a){h.splice(b,1);break}};window.JOT_removeAllListenersForName=function(a){for(var b=0;b<h.length;b++)h[b].eventName==a&&h.splice(b,1)};
window.JOT_postEvent=function(a,b,c){var f={eventName:a,eventSrc:b||{},payload:c||{}};if(window.JOT_fullyLoaded)for(b=h.length,c=0;c<b&&c<h.length;c++){var e=h[c];e&&e.eventName==a&&(f.listenerCompId=e.compId||"",(e="function"==typeof e.handler?e.handler:window[e.handler])&&e(f))}else window.JOT_delayedEvents.push({eventName:a,eventSrc:b,payload:c})};window.JOT_delayedEvents=[];window.JOT_fullyLoaded=!1;
window.JOT_formatRelativeToNow=function(a,b){a=((new Date).getTime()-a)/6E4;if(1440<=a||0>a)return null;var c=0;60<=a&&(a/=60,c=2);2<=a&&c++;return b?window.JOT_siteRelTimeStrs[c].replace("__duration__",Math.floor(a)):window.JOT_userRelTimeStrs[c].replace("__duration__",Math.floor(a))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/site/qeewiki/books","deleted":false,"title":"My Books","dir":"ltr"},{"path":"/site/qeewiki/books/avr-guide","deleted":false,"title":"AVR GUIDE","dir":"ltr"},{"path":"/site/qeewiki/books/avr-guide/pwm-atmega8","deleted":false,"title":"PWM On The ATmega8","dir":"ltr"}];
  var JOT_clearDotPath = 'https://ssl.gstatic.com/sites/p/cc68c3/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"gvizGstaticVersion":"current","enableAnalytics":true,"pageSharingId":"jotspot_page","codeembeds":{"outerIframeSrc":"https://www.gstatic.com/jotspot/embeds/code/0f08d42392f2000e7e3f3daf5b427a43/outer_iframe.html","innerIframeSrc":"https://259096127-jotspot-embeds.googleusercontent.com/code/8d87fa64604b2a11fae2ed06104c58d3/inner_iframe.html"},"enableUniversalAnalytics":false,"sharingPolicy":"OPENED","siteTitle":"QEEWiki","jot2atari":{"eligibility":"ineligible"},"onepickUrl":"https://docs.google.com/picker","adsensePublisherId":"ca-pub-5107231512580887","features":{"moreMobileStyleImprovements":null,"subscriptionDataMigrationInProgress":null,"plusBadge":false},"isPublic":true,"newSitesBaseUrl":"https://sites.google.com","isConsumer":true,"serverFlags":{"jot2AtariLearnMoreUrl":"https://support.google.com/sites/answer/7035197"},"domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://accounts.google.com/AccountChooser?continue\u003dhttps://sites.google.com/site/qeewiki/books/avr-guide/pwm-atmega8\u0026service\u003djotspot","analyticsAccountId":"UA-21612997-1","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/cc68c3/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/cc68c3/system/js/codemirror.js","https://ssl.gstatic.com/sites/p/cc68c3/system/app/css/codemirror_css.css","https://ssl.gstatic.com/sites/p/cc68c3/system/js/trog_edit__en.js","https://ssl.gstatic.com/sites/p/cc68c3/system/app/css/trogedit.css","/site/qeewiki/_/rsrc/1613031691000/system/app/css/editor.css","https://ssl.gstatic.com/sites/p/cc68c3/system/app/css/codeeditor.css","/site/qeewiki/_/rsrc/1613031691000/system/app/css/camelot/editor-jfk.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"defaultdomain","baseUri":"/site/qeewiki","name":"qeewiki","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/books/avr-guide","parentWuid":"wuid:gx:5233ae16d3813d0e","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"PWM On The ATmega8","locale":"en","wuid":"wuid:gx:2160272eea68d0f9","revision":36,"path":"/books/avr-guide/pwm-atmega8","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"pwm-atmega8","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","onePickToken":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/site/qeewiki/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="google-site-verification" content="orvQ4DFSfx4CAZweO0v6wepgC6eoAdNyEYQgR82As_0" />
<meta name="title" content="PWM On The ATmega8 - QEEWiki" />
<meta itemprop="name" content="PWM On The ATmega8 - QEEWiki" />
<meta property="og:title" content="PWM On The ATmega8 - QEEWiki" />
<meta name="description" content="Q's Electrical Engineering Wiki" />
<meta itemprop="description" content="Q's Electrical Engineering Wiki" />
<meta id="meta-tag-description" property="og:description" content="Q's Electrical Engineering Wiki" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="https://ssl.gstatic.com/sites/p/cc68c3/system/app/themes/simple/standard-css-simple-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="/site/qeewiki/_/rsrc/1613031691000/system/app/css/overlay.css?cb=simple960px70175goog-ws-leftnonethemedefaultstandard" />
<link rel="stylesheet" type="text/css" href="/site/qeewiki/_/rsrc/1613031691000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/site/qeewiki/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>PWM On The ATmega8 - QEEWiki</title>
<meta itemprop="image" content="https://sites.google.com/site/qeewiki/_/rsrc/1297488013241/books/avr-guide/pwm-atmega8/ATmega8%20-%20PWM.JPG" />
<meta property="og:image" content="https://sites.google.com/site/qeewiki/_/rsrc/1297488013241/books/avr-guide/pwm-atmega8/ATmega8%20-%20PWM.JPG" />
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner" style="height: 70px"><div class="sites-header-cell-buffer-wrapper"><h2><a href="https://sites.google.com/site/qeewiki/" dir="ltr" id="sites-chrome-userheader-title">QEEWiki</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="/site/qeewiki/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site" /><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site" /><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:175px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_2bd" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Navigation</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList" class="has-expander"><li class="topLevel nav-first "><div dir="ltr" style="padding-left: 19px;"><a href="/site/qeewiki/home" jotId="wuid:gx:3b2a480be041e60" class="sites-navigation-link topLevel">Home</a></div></li><li class="topLevel parent " wuid="gx:1ec109d3ab18d07f"><div dir="ltr" style="padding-left: 0px;"><div class="expander"></div><a href="/site/qeewiki/projects" jotId="wuid:gx:1ec109d3ab18d07f" class="sites-navigation-link topLevel">My Projects</a></div><ul role="navigation" class="has-expander"><li class=""><div dir="ltr" style="padding-left: 38px;"><a href="/site/qeewiki/projects/birchall-exhibit" jotId="wuid:gx:2f17363d8ef867da" class="sites-navigation-link">Leonard Birchall Exhibit</a></div></li><li class=""><div dir="ltr" style="padding-left: 38px;"><a href="/site/qeewiki/projects/plc" jotId="wuid:gx:8f11d54a6150943" class="sites-navigation-link">PLC [Hardware Project]</a></div></li><li class=""><div dir="ltr" style="padding-left: 38px;"><a href="/site/qeewiki/projects/q-s-max7456-img-gen" jotId="wuid:gx:3e8d0842432aa385" class="sites-navigation-link">Q's MAX7456 Img Gen</a></div></li><li class=""><div dir="ltr" style="padding-left: 38px;"><a href="/site/qeewiki/projects/briefcase-controller" jotId="wuid:gx:454516d6082c8052" class="sites-navigation-link">Briefcase Controller [In Development]</a></div></li><li class=""><div dir="ltr" style="padding-left: 38px;"><a href="/site/qeewiki/home/solidworks-projects" jotId="wuid:gx:6c95446145ec8103" class="sites-navigation-link">SolidWorks Projects</a></div></li></ul></li><li class="topLevel parent " wuid="gx:535b3f3a2562e7ad"><div dir="ltr" style="padding-left: 0px;"><div class="expander"></div><a href="/site/qeewiki/books" jotId="wuid:gx:535b3f3a2562e7ad" class="sites-navigation-link topLevel">My Books</a></div><ul role="navigation" class="has-expander"><li class=""><div dir="ltr" style="padding-left: 38px;"><a href="/site/qeewiki/books/avr-guide" jotId="wuid:gx:5233ae16d3813d0e" class="sites-navigation-link">AVR GUIDE</a></div></li><li class=""><div dir="ltr" style="padding-left: 38px;"><a href="/site/qeewiki/books/3d-printing-guide" jotId="wuid:gx:7a019a1555c1b6b" class="sites-navigation-link">3D Printing Guide</a></div></li></ul></li><li class="topLevel parent " wuid="gx:431df5631c9dc5f5"><div dir="ltr" style="padding-left: 0px;"><div class="expander"></div><a href="/site/qeewiki/my-bike" jotId="wuid:gx:431df5631c9dc5f5" class="sites-navigation-link topLevel">My Bike</a></div><ul role="navigation" class="has-expander"><li class=""><div dir="ltr" style="padding-left: 38px;"><a href="/site/qeewiki/my-bike/shadow-rs-saddlebag-mounts" jotId="wuid:gx:2b90dc9079e015f1" class="sites-navigation-link">Shadow RS Saddlebag Mounts</a></div></li><li class=""><div dir="ltr" style="padding-left: 38px;"><a href="/site/qeewiki/my-bike/viper-security-system-fail" jotId="wuid:gx:148fcf698abf9658" class="sites-navigation-link">Viper Security System Fail</a></div></li></ul></li><li class="topLevel "><div dir="ltr" style="padding-left: 19px;"><a href="/site/qeewiki/datasheet-library" jotId="wuid:gx:bd46660b1977317" class="sites-navigation-link topLevel">Datasheet Library</a></div></li><li class="topLevel "><div dir="ltr" style="padding-left: 19px;"><a href="/site/qeewiki/friends-tutorials" jotId="wuid:gx:79bc3e8ef01d5fd7" class="sites-navigation-link topLevel">Friends Tutorials</a></div></li><li class="topLevel "><div dir="ltr" style="padding-left: 19px;"><a href="/site/qeewiki/components" jotId="wuid:gx:38afe48728a6cbb2" class="sites-navigation-link topLevel">Components</a></div></li><li class="topLevel "><div dir="ltr" style="padding-left: 19px;"><a href="/site/qeewiki/usefull-avr-stuff" jotId="wuid:gx:9d929f8c6b8e7ca" class="sites-navigation-link topLevel">Usefull Engineering Stuff</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_5818525579565211" class="sites-embed" role="navigation"><h4 class="sites-embed-title">Resources</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList" class="has-expander"><li class="topLevel nav-first "><div dir="ltr" style="padding-left: 19px;"><a href="http://www.sparkfun.com" class="sites-navigation-link topLevel">Sparkfun</a></div></li><li class="topLevel "><div dir="ltr" style="padding-left: 19px;"><a href="http://arduino.cc/en/Reference/HomePage" class="sites-navigation-link topLevel">Arduino Reference</a></div></li><li class="topLevel "><div dir="ltr" style="padding-left: 19px;"><a href="http://www.eevblog.com/" class="sites-navigation-link topLevel">EEVBlog</a></div></li><li class="topLevel "><div dir="ltr" style="padding-left: 19px;"><a href="http://fritzing.org/download/" class="sites-navigation-link topLevel">Fritzing Projects</a></div></li><li class="topLevel "><div dir="ltr" style="padding-left: 19px;"><a href="http://www.adafruit.com/" class="sites-navigation-link topLevel">Ada Fruit</a></div></li><li class="topLevel "><div dir="ltr" style="padding-left: 19px;"><a href="http://www.pololu.com/" class="sites-navigation-link topLevel">Pololu</a></div></li><li class="topLevel parent "><div dir="ltr" style="padding-left: 0px;"><div class="expander"></div><a href="http://www.atmel.com" class="sites-navigation-link topLevel">Atmel</a></div><ul role="navigation" class="has-expander"><li class=""><div dir="ltr" style="padding-left: 38px;"><a href="http://www.atmel.com/dyn/resources/prod_documents/doc2486.pdf" class="sites-navigation-link">Atmega8 Datasheet</a></div></li><li class=""><div dir="ltr" style="padding-left: 38px;"><a href="http://www.atmel.com/Images/Atmel-8271-8-bit-AVR-Microcontroller-ATmega48A-48PA-88A-88PA-168A-168PA-328-328P_datasheet.pdf" class="sites-navigation-link">ATMega168/328 Datasheet</a></div></li></ul></li><li class="topLevel "><div dir="ltr" style="padding-left: 19px;"><a href="/site/qeewiki/software-links" jotId="wuid:gx:2c8ace555c82644b" class="sites-navigation-link topLevel">Software Links</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_6477897660156883" class="sites-embed" role="navigation"><h4 class="sites-embed-title">None EE Faves</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotId="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://www.minecraft.net/" class="sites-navigation-link">Minecraft !!!</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://www.exploremusic.com/shows/ongoing-history-of-new-music/" class="sites-navigation-link">Ongoing History of New Music</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://www.white-wolf.com/" class="sites-navigation-link">White Wolf Ent.</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://www.escapistmagazine.com/videos/view/there-will-be-brawl" class="sites-navigation-link">There Will Be BRAWL</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_9013322391547263" class="sites-embed" role="complementary"><div class="sites-embed-content-notitle"><span jotId="content"><p><script type="text/javascript">
<!--
google_ad_client="pub-5107231512580887";
google_ad_host="pub-6693688277674466";
google_ad_width=120;
google_ad_height=600;
google_ad_format="120x600_as";
google_ad_type="text_image";
google_color_border="EEEEEE";
google_color_bg="EEEEEE";
google_color_link="000000";
google_color_url="0000CC";
google_color_text="000000";
//-->
</script>
<script type="text/javascript" src="https://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</p></span></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="/site/qeewiki/books" dir="ltr">My Books</A>‎ &gt; ‎<A href="/site/qeewiki/books/avr-guide" dir="ltr">AVR GUIDE</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">PWM On The ATmega8</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-layout-name-one-column-hf sites-layout-vbox"><div class="sites-layout-tile sites-tile-name-header sites-layout-empty-tile"><div dir="ltr"><br /></div></div><div class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><b><font face="'courier new', monospace" size="3">INTRODUCTION:</font></b><div><br /></div><div><span>    We know that the AVR lets us turn outputs on and off, but, what if we want to control the brightness of an LED or the speed of a motor?  Well the easiest way to do this is to change the voltage of the output but we can fake it.  If we take a voltage source and connect it for a second and then disconnect it  for a second it will .... well be on for a second then off for a second. BUT, if we manage to speed this up so that we connect/disconnect the power supply over 1000 times a second we can fool the power supply into thinking that our signal is half the value of the power supply.</span> This is called Pulse Width Modulation or PWM for short.</div><div><br /></div><div><br /></div><div><hr /></div><div><br /></div><div><br /></div><div><span style="font-family:courier new,monospace;font-size:medium"><b>THEORY OF OPERATION:</b></span></div><div><br /><div style="display:block;text-align:left"><a href="https://sites.google.com/site/qeewiki/books/avr-guide/pwm-atmega8/ATmega8%20-%20PWM.JPG?attredirects=0" imageanchor="1"><img border="0" src="https://sites.google.com/site/qeewiki/_/rsrc/1297488013241/books/avr-guide/pwm-atmega8/ATmega8%20-%20PWM.JPG" /></a></div></div><div><div style="display:block;text-align:left"></div><i style="font-family:courier new,monospace">Figure 1: ATmega8 - PWM Pins</i></div><div><br /></div><div><span>    When you take a square wave, its on for a while and off for a while.  If we divide the on by the off and multiply by 100% we will get what is called a duty cycle.</span><br /></div><div><span><br /></span></div><blockquote style="border:medium none;margin:0pt 0pt 0pt 40px;padding:0px"><span style="color:rgb(0,0,255)">Duty_Cycle = [</span><span style="color:rgb(0,0,255)">ON_time / (ON_time + OFF_time) ] * 100 </span></blockquote><div><span><br /></span></div><div><span><span>    So if we are on for 1ms and then off for 1ms we will end up with a 50% duty cycle;  If we are on for 1ms and off for 3ms we end up with a 25% duty cycle.</span><br /></span></div><div><span><span><br /></span></span></div><blockquote style="border:medium none;margin:0pt 0pt 0pt 40px;padding:0px"><span style="color:rgb(0,0,255)">Output_Voltage = </span><span style="color:rgb(0,0,255)">Duty_Cycle * Input_Voltage</span><div><span><span><br /></span></span></div></blockquote><span>    Now if we take our duty cycle and multiply it by our voltage we will get the output voltage.  So if we have a 5V power supply and we activate a PWM on a 25% duty cycle we will make an analog device behave as if it was receiving a 1.25V signal. </span>Cool eh!?<div><br /></div><div><span>    Much like the counter functions PWM can be simulated in software however, the hardware version is preferred because it just sort of does its own thing and, with very little coding you can get a constant square wave going.</span></div><div><br /></div><div><span>    Remember the Prescaler? well its back in the PWM.  And much like in the counter, its roll is to slow things down.  This is good because it allows us to run the PWM at different frequencies.  This is important because some devices are sensitive to PWM speeds.  A motor for example will get hot if the PWM waveform is too fast, and will jitter if the PWM is too slow.  Since I already planted the question in your head, the answer is start at 10kHz.  Different motors like different frequencies but 10kHz will get you into the ball park.</span></div><div><br /></div><div><span><span>    The ATmega8 has 3 PWM outputs, 2 are located on timer/counter1 (16bit) and 1 is located on timer/counter2 (8bit).</span><br /></span></div><div><span><span><br /></span></span></div><div><br /></div><div><span>    As always, the output pin has the same limitations as any output (see the <a href="https://sites.google.com/site/qeewiki/books/avr-guide/digital-outputs">Digital Output Chapter</a> for details).</span><br /></div><div><br /></div><div><span><span><span><br /><hr /></span></span></span></div><div><span><span><span><br /></span></span></span></div><div><span><span><span>    </span><br /></span></span></div><div><div><b><font face="'courier new', monospace" size="3">TIMER2 (8BIT PWM):</font></b></div></div><div><br /></div><div><div style="display:block;text-align:left"><a href="https://sites.google.com/site/qeewiki/books/avr-guide/pwm-atmega8/PWM%20-%20ATmega8.JPG?attredirects=0" imageanchor="1"><img border="0" src="https://sites.google.com/site/qeewiki/_/rsrc/1294983716601/books/avr-guide/pwm-atmega8/PWM%20-%20ATmega8.JPG" /></a></div><i style="font-family:courier new,monospace">Figure 2: ATmega8 Timer2 (8bit)</i></div><div><br /></div><div><br /></div><div><span>    </span>Timer/Counter2 is the simplest PWM device on the ATmega8.</div><div><span><br /></span></div><div><span><span>    Timer/Counter2 is capable of running on 2 modes the Fast PWM mode and the Phase Corrected PWM mode. And each of these modes can be inverted or none-inverted.</span><br /></span></div><div><span><span><br /></span></span></div><div><span><span><br /></span></span></div><div><span><span><br /></span></span></div><div><span><span><i><font face="'courier new', monospace" size="3">Fast PWM mode:</font></i></span></span></div><div><span><span><br /></span></span></div><div><span><span><span>    Fast PWM works the same way as the normal counter.  </span></span></span>The Control Logic receives the signal and increments the TCNT2 register.  When a match is detected the OCF0x flag is set and signal is send to the Waveform Generator.  The Waveform Generator then changes the state of the OC0x pin (the state is determined by the selected mode).  When the TCNT2 register passes the TOP value (0xFF or 255) it simply overflows (or overruns) back to 0, at the same time the OCF2 flag is set.  The OCF2 flag can be configured to trigger an interrupt.  The OCF2 flag can be cleared by software, but as always is cleared automatically when an interrupt request is triggered</div><div><br /></div><div><span>    This mode can be inverted or none-inverted.  In none-inverted mode OC2 pin is HIGH(VCC) if TCNT2 is less then OCR2 and LOW(GND) if TCNT2 is greater then or equal to OCR2.  In inverted mode the </span>OC2 pin is LOW(GND) if TCNT2 is less then OCR2 and HIGH(VCC) if TCNT2 is greater then or equal to OCR2.</div><div><br /></div><div><span>    Due to the high frequency of this mode is best used for DAC, fading LEDs, rectification and Power regulation.</span><br /></div><div><span><br /></span></div><div><span><span>    The Frequency of the fast PWM can be calculated by the following equation.</span><br /></span></div><div><span><br /></span></div><blockquote style="border:medium none;margin:0pt 0pt 0pt 40px;padding:0px"><div><div><font color="#0000ff">PWM_fequency = clock_speed / (Prescaller_value * 256) </font></div></div></blockquote><div><br /></div><div><br /></div><div><br /></div><div><font face="'courier new', monospace" size="3"><i>Phase Corrected PWM:</i></font></div><div><br /></div><div><span>    The phase corrected mode is a bit strange, it counts up until it hits the TOP value (0xFF or 255) then starts to count down until it hits the BOTTOM (0).  </span>The Control Logic receives the signal and increments the TCNT2 register.  When a match is detected the OCF2 flag is set and signal is send to the Waveform Generator.  The Waveform Generator then changes the state of the OC2 pin (the state is determined by the selected mode).  When the TCNT2 register hits the TOP value (0xFF) the OCF2 flag is set. The OCF2 flag can be configured to trigger an interrupt.  The OCF2 flag can be cleared by software, but as always is cleared automatically when an interrupt request is triggered. </div><div><br /></div><div><span>    This mode can be inverted or none-inverted.  </span>In none-inverting mode, the OC2 pin is LOW(GND) on the Compare Match between TCNT2 and OCR2 while up-counting, and HIGH(VCC) on the Compare Match while down-counting.  In inverting mode, the OC2 pin is HIGH(VCC) on the Compare Match between TCNT2 and OCR2 while up-counting, and LOW(GND) on the Compare Match while down-counting.</div><div><br /></div><div><span>    This mode is recommended for motor control.</span></div><div><span><br /></span></div><div><span><span>    The frequency of the Phase Corrected PWM can be calculated by the following equation.</span></span></div><div><span><br /></span></div><blockquote style="border:medium none;margin:0pt 0pt 0pt 40px;padding:0px"><div><font color="#0000ff">PWM_frequency = clock_speed / ( Prescaller_value * 510 )</font></div></blockquote><div><br /></div><div><br /></div><div><br /></div><div><div><span><table border="1" bordercolor="#888888" cellspacing="0" style="border-color:rgb(136,136,136);border-width:1px;margin:0px;text-align:center;border-collapse:collapse"><tbody><tr><td style="vertical-align:top;text-align:center;width:59px;height:15px"> </td><td style="vertical-align:top;text-align:center;width:59px"><b> 7 bit</b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 6 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 5 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 4 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 3 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 2 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 1 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 0 bit</b> </td></tr><tr><td style="vertical-align:top;text-align:center;height:15px"> <b>TCCR2</b></td><td style="vertical-align:top;text-align:center;color:rgb(255,0,0);background-color:rgb(255,242,204)">FOC2</td><td style="vertical-align:top;text-align:center">WGM21 </td><td style="vertical-align:top;text-align:center">COM21</td><td style="vertical-align:top;text-align:center">COM20</td><td style="vertical-align:top;text-align:center">WGM20</td><td style="vertical-align:top;text-align:center"> CS22</td><td style="vertical-align:top;text-align:center"> CS21</td><td style="vertical-align:top;text-align:center">CS20 </td></tr></tbody></table><div style="text-align:left;font-family:courier new,monospace"><i>Timer/Counter Control Register 2</i></div></span></div><div><span><br /></span></div><div><span><br /></span></div><blockquote style="border-style:none;margin:0px 0px 0px 40px;padding:0px"><div><table border="1" bordercolor="#888888" cellspacing="0" style="border-color:rgb(136,136,136);border-width:1px;margin:0px;border-collapse:collapse"><tbody><tr><td style="vertical-align:top;width:52px;height:15px"><b> CS22</b></td><td style="vertical-align:top;width:52px;height:15px"><b> CS21 </b></td><td style="vertical-align:top;width:52px;height:15px"><b> CS20 </b></td><td style="vertical-align:top;width:362px;height:15px"><b> DESCRIPTION</b></td></tr><tr><td style="vertical-align:top;text-align:center;width:52px;height:15px">0</td><td style="vertical-align:top;text-align:center;width:52px;height:15px">0 </td><td style="vertical-align:top;text-align:center;width:52px;height:15px">0 </td><td style="vertical-align:top;text-align:left;width:362px;height:15px"> Timer/Counter2 Disabled </td></tr><tr><td style="vertical-align:top;text-align:center;width:52px;height:15px">0</td><td style="vertical-align:top;text-align:center;width:52px;height:15px">0 </td><td style="vertical-align:top;text-align:center;width:52px;height:15px">1 </td><td style="vertical-align:top;text-align:left;width:362px;height:15px"> No Prescaling</td></tr><tr><td style="text-align:center;width:52px;height:15px">0</td><td style="text-align:center;width:52px;height:15px">1 </td><td style="text-align:center;width:52px;height:15px">0 </td><td style="width:362px;height:15px"> Clock / 8</td></tr><tr><td style="text-align:center;width:52px;height:15px">0</td><td style="text-align:center;width:52px;height:15px">1 </td><td style="text-align:center;width:52px;height:15px">1 </td><td style="width:362px;height:15px"> Clock / 32</td></tr><tr><td style="text-align:center;width:52px;height:15px">1</td><td style="text-align:center;width:52px;height:15px">0 </td><td style="text-align:center;width:52px;height:15px">0 </td><td style="width:362px;height:15px"> Clock / 64</td></tr><tr><td style="text-align:center;width:52px;height:15px">1</td><td style="text-align:center;width:52px;height:15px">0 </td><td style="text-align:center;width:52px;height:15px">1 </td><td style="width:362px;height:15px"> Clock / 128</td></tr><tr><td style="vertical-align:top;text-align:center;width:52px;height:15px">1</td><td style="vertical-align:top;text-align:center;width:52px;height:15px">1 </td><td style="vertical-align:top;text-align:center;width:52px;height:15px">0 </td><td style="vertical-align:top;text-align:left;width:362px;height:15px"> Clock / 256</td></tr><tr><td style="vertical-align:top;text-align:center;width:52px;height:16px">1</td><td style="vertical-align:top;text-align:center;width:52px;height:16px">1 </td><td style="vertical-align:top;text-align:center;width:52px;height:16px">1 </td><td style="vertical-align:top;text-align:left;width:362px;height:16px"> Clock / 1024 </td></tr></tbody></table><i style="font-family:courier new,monospace">CS bits</i></div></blockquote><div><br /></div><div><br /></div></div><blockquote style="border:medium none;margin:0pt 0pt 0pt 40px;padding:0px"><div><div><table border="1" bordercolor="#888888" cellspacing="0" style="border-color:rgb(136,136,136);border-width:1px;margin:0px;border-collapse:collapse"><tbody><tr><td style="vertical-align:top;width:52px;height:15px"><b> MODE</b></td><td style="vertical-align:top;width:53px;height:15px"><b>WGM21</b></td><td style="vertical-align:top;width:53px;height:15px"><b>WGM20 </b></td><td style="vertical-align:top;width:362px;height:15px"><b> DESCRIPTION</b></td></tr><tr><td style="vertical-align:top;text-align:center;width:52px;height:15px;color:rgb(153,153,153);background-color:rgb(243,243,243)">0</td><td style="vertical-align:top;text-align:center;width:53px;height:15px;color:rgb(153,153,153);background-color:rgb(243,243,243)">0 </td><td style="vertical-align:top;text-align:center;width:53px;height:15px;color:rgb(153,153,153);background-color:rgb(243,243,243)">0 </td><td style="vertical-align:top;text-align:left;width:362px;height:15px;color:rgb(153,153,153);background-color:rgb(243,243,243)"> Normal </td></tr><tr><td style="vertical-align:top;text-align:center;width:52px;height:15px">1</td><td style="vertical-align:top;text-align:center;width:53px;height:15px">0 </td><td style="vertical-align:top;text-align:center;width:53px;height:15px">1 </td><td style="vertical-align:top;text-align:left;width:362px;height:15px"> PWM Phase Corrected</td></tr><tr><td style="vertical-align:top;text-align:center;width:52px;height:15px;color:rgb(153,153,153);background-color:rgb(243,243,243)">2</td><td style="vertical-align:top;text-align:center;width:53px;height:15px;color:rgb(153,153,153);background-color:rgb(243,243,243)">1 </td><td style="vertical-align:top;text-align:center;width:53px;height:15px;color:rgb(153,153,153);background-color:rgb(243,243,243)">0 </td><td style="vertical-align:top;text-align:left;width:362px;height:15px;color:rgb(153,153,153);background-color:rgb(243,243,243)"> CTC</td></tr><tr><td style="vertical-align:top;text-align:center;width:52px;height:16px">3</td><td style="vertical-align:top;text-align:center;width:53px;height:16px">1 </td><td style="vertical-align:top;text-align:center;width:53px;height:16px">1 </td><td style="vertical-align:top;text-align:left;width:362px;height:16px"> Fast PWM </td></tr></tbody></table></div></div></blockquote><blockquote style="border:medium none;margin:0pt 0pt 0pt 40px;padding:0px;font-family:courier new,monospace"><div><div><i>Waveform Generator Mode bits</i></div></div></blockquote><div><div><br /></div></div><div><br /></div><blockquote style="border:medium none;margin:0pt 0pt 0pt 40px;padding:0px"><div><div><table border="1" bordercolor="#888888" cellspacing="0" style="border-color:rgb(136,136,136);border-width:1px;margin:0px;border-collapse:collapse"><tbody><tr><td style="vertical-align:top;width:50px;height:15px"><b>COM21</b></td><td style="vertical-align:top;width:50px;height:15px"><b>COM20 </b></td><td style="vertical-align:top;width:431px;height:15px"><b> DESCRIPTION</b></td></tr><tr><td style="vertical-align:top;text-align:center;width:50px;height:15px">0</td><td style="vertical-align:top;text-align:center;width:50px;height:15px">0 </td><td style="vertical-align:top;text-align:left;width:431px;height:15px"> OC2 disabled</td></tr><tr><td style="vertical-align:top;text-align:center;width:50px;height:15px;color:rgb(204,204,204);background-color:rgb(243,243,243)">0</td><td style="vertical-align:top;text-align:center;width:50px;height:15px;color:rgb(204,204,204);background-color:rgb(243,243,243)">1 </td><td style="vertical-align:top;text-align:left;width:431px;height:15px;color:rgb(204,204,204);background-color:rgb(243,243,243)"> Reserved</td></tr><tr><td style="vertical-align:top;text-align:center;width:50px;height:15px">1</td><td style="vertical-align:top;text-align:center;width:50px;height:15px">0 </td><td style="vertical-align:top;text-align:left;width:431px;height:15px"> None-inverted mode (HIGH at bottom, LOW on Match)</td></tr><tr><td style="vertical-align:top;text-align:center;width:50px;height:15px">1</td><td style="vertical-align:top;text-align:center;width:50px;height:15px">1 </td><td style="vertical-align:top;text-align:left;width:431px;height:15px"> Inverted mode (LOW at bottom, HIGH on Match)</td></tr></tbody></table></div></div></blockquote><blockquote style="border:medium none;margin:0pt 0pt 0pt 40px;padding:0px;font-family:courier new,monospace"><div><div><i>Applies only to PWM modes</i></div></div></blockquote><div><div><br /></div><div><br /></div><div><table border="1" bordercolor="#888888" cellspacing="0" style="border-color:rgb(136,136,136);border-width:1px;margin:0px;text-align:center;border-collapse:collapse"><tbody><tr><td style="vertical-align:top;text-align:center;width:59px;height:15px"> </td><td style="vertical-align:top;text-align:center;width:59px"><b> 7 bit</b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 6 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 5 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 4 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 3 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 2 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 1 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 0 bit</b> </td></tr><tr><td style="vertical-align:top;text-align:center;height:15px"> <b>TIMSK</b></td><td style="vertical-align:top;text-align:center"> OCIE2</td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)">TOIE2 </td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)">TICIE1 </td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)">OCIE1A </td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)">OCIE1B </td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)"> TOIE1</td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)"> -</td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)">TOIE0 </td></tr></tbody></table><div style="text-align:left;font-family:courier new,monospace"><i>Timer/Counter Interrupt Mask Register</i></div></div><div style="text-align:left"><i><br /></i></div><div style="text-align:left"><i><br /></i></div><div style="text-align:left"><i><span style="font-style:normal"><table border="1" bordercolor="#888888" cellspacing="0" style="border-color:rgb(136,136,136);border-width:1px;margin:0px;text-align:center;border-collapse:collapse"><tbody><tr><td style="vertical-align:top;text-align:center;width:59px;height:15px"> </td><td style="vertical-align:top;text-align:center;width:59px"><b> 7 bit</b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 6 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 5 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 4 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 3 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 2 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 1 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 0 bit</b> </td></tr><tr><td style="vertical-align:top;text-align:center;height:15px"> <b>TIFR</b></td><td style="vertical-align:top;text-align:center"> OCF2</td><td style="vertical-align:top;text-align:center">TOV2<font color="#666666"> </font></td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)">ICF1 </td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)">OCF1A </td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)">OCF1B </td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)"> TOV1</td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)"> -</td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)">TOV0 </td></tr></tbody></table><div style="text-align:left;font-family:courier new,monospace"><i>Timer/Counter Interrupt Flag Register</i></div></span></i></div><div><br /></div><div><br /></div><div><i><span style="font-style:normal"><table border="1" bordercolor="#888888" cellspacing="0" style="border-color:rgb(136,136,136);border-width:1px;margin:0px;text-align:center;border-collapse:collapse"><tbody><tr><td style="vertical-align:top;text-align:center;width:59px;height:15px"> </td><td style="vertical-align:top;text-align:center;width:59px"><b> 7 bit</b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 6 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 5 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 4 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 3 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 2 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 1 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 0 bit</b> </td></tr><tr><td style="vertical-align:top;text-align:center;height:15px"> <b>TCNT2</b></td><td style="vertical-align:top;text-align:center"> </td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"> </td></tr></tbody></table><div style="text-align:left;font-family:courier new,monospace"><i>Timer/Counter Register (stores the counter value)</i></div><div><i><br /></i></div><div><i><br /></i></div></span></i></div></div><div><i><span style="font-style:normal"><table border="1" bordercolor="#888888" cellspacing="0" style="border-color:rgb(136,136,136);border-width:1px;margin:0px;text-align:center;border-collapse:collapse"><tbody><tr><td style="vertical-align:top;text-align:center;width:59px;height:15px"> </td><td style="vertical-align:top;text-align:center;width:59px"><b> 7 bit</b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 6 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 5 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 4 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 3 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 2 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 1 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 0 bit</b> </td></tr><tr><td style="vertical-align:top;text-align:center;height:15px"> <b>OCR2</b></td><td style="vertical-align:top;text-align:center"> </td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"> </td></tr></tbody></table><div style="text-align:left;font-family:courier new,monospace"><i>Output Compare Register (stores the compare value)</i></div></span></i></div><div><br /><br /><br /></div><div><div><i>ATmega8 Code:</i><br /></div><div class="sites-codeblock sites-codesnippet-block" style="border:1px solid rgb(211,211,211);padding:0.5em 0px 0.5em 1em;background-color:rgb(239,239,239);display:block;line-height:13px"><div><code style="color:rgb(0,96,0)">// this code sets up counter2 for an 8kHz Fast PWM wave @ 16Mhz Clock</code><br /><br /><br /><code style="color:rgb(0,96,0)">#include &lt;avr/io.h&gt;</code><br /><br /><br /><code style="color:rgb(0,96,0)">int main(void)</code><br /><code style="color:rgb(0,96,0)">{</code><br /><code style="color:rgb(0,96,0)"><span>    </span>DDRB |= (1 &lt;&lt; DDB3);</code><br /><code style="color:rgb(0,96,0)"><span>    </span>// PB3 is now an output</code></div><div><font color="#006000" face="monospace"><br /></font></div><div><font color="#006000" face="monospace"><span>    OCR2 = 128;</span></font></div><div><font color="#006000" face="monospace"><span>    // set PWM for 50% duty cycle</span><br /></font><br /></div><div><br /></div><div><code style="color:rgb(0,96,0)"><span><span>    TCCR2 |= (1 &lt;&lt; COM21);</span></span></code></div><div><code style="color:rgb(0,96,0)"><span><span>    // set none-inverting mode</span></span><br /></code></div><div><code style="color:rgb(0,96,0)"><span><br /></span></code></div><div><code style="color:rgb(0,96,0)"><span><span>    TCCR2 |= (1 &lt;&lt; WGM21) | (1 &lt;&lt; WGM20);</span><br /></span></code></div><div><code style="color:rgb(0,96,0)"><span><span><span>    // set fast PWM Mode</span><br /></span></span></code></div><div><br /></div><div><code style="color:rgb(0,96,0)"><span>    </span>TCCR2 |= (1 &lt;&lt; CS21);</code><br /><code style="color:rgb(0,96,0)"><span>    </span>// set prescaler to 8 and starts PWM</code></div><div><br /><br /><code style="color:rgb(0,96,0)"><span>    </span>while (1)</code><br /><code style="color:rgb(0,96,0)"><span>    </span>{</code><br /><code style="color:rgb(0,96,0)"><span>    <span>    </span></span>// we have a working Fast PWM</code></div><div><code style="color:rgb(0,96,0)"><span>    </span>}</code><br /><code style="color:rgb(0,96,0)">}</code></div></div></div><div><br /></div><div><br /></div><div><hr /><br /></div><div><b><font face="'courier new', monospace" size="3"><br /></font></b></div><div><b><font face="'courier new', monospace" size="3">TIMER1 (16BIT PWM):</font></b></div><div><br /></div><div><div style="display:block;text-align:left"><a href="https://sites.google.com/site/qeewiki/books/avr-guide/pwm-atmega8/PWM%20-%2016%20Bit%20-%20ATmega8.JPG?attredirects=0" imageanchor="1"><img border="0" src="https://sites.google.com/site/qeewiki/_/rsrc/1295325754757/books/avr-guide/pwm-atmega8/PWM%20-%2016%20Bit%20-%20ATmega8.JPG" /></a></div><i style="font-family:courier new,monospace">Figure 3: ATmega328 Timer1 (16bit)</i></div><div><br /></div><div><br /></div><div><span>    Timer/Counter1 is pretty cool because it has 2 outputs, OC1A and OC1B.  Since both of these outputs run off the same timer and waveform generators both OC1A and OC1B are synchronized, this make the timer perfect for making tank robots (I love tank robots).</span><br /></div><div><span><br /></span></div><div><span>    Timer/Counter1 works the same way as Timer/Counter2.  </span>The OCR1A/OCR1B are compared to the TCNT1 registers, when a match is detected the OCF1A/OCF1B flag is set and the signal is send to the Waveform Generator.  The Waveform Generator then changes the state of the OC1A/OC1B pin (the state is determined by the selected mode).  The OCF1A/OCF1B flag can be configured to trigger an interrupt.  The OCF1A/OCF1B flag can be cleared by software, but as always is cleared automatically when an interrupt request is triggered.  Timer/Counter1 has a separate vector for A and B with A having priority.</div><div><br /></div><div><span>    </span>Timer/Counter1 is capable of running in 3 modes the Fast PWM mode, the Phase Corrected PWM mode and, Phase and Frequency Corrected mode.  Each of these modes can be inverted or none-inverted.  Unlike Timer/Counter2 Timer/Counter1 has several options for controlling the max value of the PWM (see chart below). Some modes have a fixed TOP such as mode 1 which is fixed at 0x00FF.  While others use a TOP value that is stored in the ICR1 or OCR1A register, such as mode 8 to 15.</div><div><br /></div><div><br /></div><div><i><font face="'courier new', monospace" size="3">Fast PWM mode:</font></i></div><div><font face="'courier new', monospace" size="3"><i><br /></i></font></div><div><font face="arial, sans-serif" size="2"><i>    </i>Fast PWM on timer/counter1 works just like it does on timer/counter2.  It counts until it reaches the top then overflows back to 0.   The big difference is that we have several Fast PWM modes with various TOP values.  The only thing that we should note is that if you use ICR1 or OCR1A for the TOP value the MINIMUM valid value is 3 (0x0003).<br /></font></div><div><i><font face="'courier new', monospace" size="3"><br /></font></i></div><div><i><font face="'courier new', monospace" size="3"><span style="font-family:Verdana,Helvetica,Arial,sans-serif;font-style:normal;font-size:13px">    Due to the high frequency of this mode is best used for DAC, fading LEDs, rectification and Power regulation.</span></font></i></div><div><i><font face="'courier new', monospace" size="3"><br /></font></i></div><div><i><font face="'courier new', monospace" size="3"><span style="font-family:Verdana,Helvetica,Arial,sans-serif;font-style:normal;font-size:13px"><div><span><span>    The Frequency of the fast PWM can be calculated by the following equation.</span><br /></span></div><div><span><br /></span></div><blockquote style="border-style:none;margin:0px 0px 0px 40px;padding:0px"><div><div><font color="#0000ff">PWM_fequency = clock_speed / [Prescaller_value * (1 + TOP_Value) ]</font></div></div></blockquote></span></font></i></div><div><i><font face="'courier new', monospace" size="3"><br /></font></i></div><div><i><font face="'courier new', monospace" size="3"><br /></font></i></div><div><i><font face="'courier new', monospace" size="3"><br /></font></i></div><div><i><font face="'courier new', monospace" size="3"><span style="font-family:Verdana,Helvetica,Arial,sans-serif;font-style:normal;font-size:13px"><i><font face="'courier new', monospace" size="3">Phase Corrected PWM mode:</font></i></span></font></i></div><div><font face="'courier new', monospace" size="3"><i><br /></i></font></div><div><i><font face="'courier new', monospace" size="3"><span style="font-family:Verdana,Helvetica,Arial,sans-serif;font-style:normal;font-size:13px"><i><font face="'courier new', monospace" size="3"><span style="font-family:Verdana,Helvetica,Arial,sans-serif;font-style:normal;font-size:13px"><div><span>   The phase corrected mode on timer/counter1 works just like the phase corrected mode on timer/counter2 (see above for details).  Once again the big difference is that we can use the value of ICR1 or OCR1A as the TOP value</span></div><div><br /></div><div><span>    This mode can be inverted or none-inverted.  </span>In none-inverting mode, the OC1 pin is LOW(GND) on the Compare Match between TCNT1 and OCR1A/OCR1B while up-counting, and HIGH(VCC) on the Compare Match while down-counting.  In inverting mode, the OC2 pin is HIGH(VCC) on the Compare Match between TCNT1 and OCR1A/OCR1B while up-counting, and LOW(GND) on the Compare Match while down-counting.</div><div><br /></div><div><span>    This mode is recommended for motor control.</span></div><div><span><br /></span></div><div><span><span>    The frequency of the Phase Corrected PWM can be calculated by the following equation.</span></span></div><div><span><br /></span></div><blockquote style="border-style:none;margin:0px 0px 0px 40px;padding:0px"><div><font color="#0000ff">PWM_frequency = clock_speed / (2 * Prescaller_value * TOP_value )</font></div></blockquote></span></font></i></span></font></i></div><div><i><font face="'courier new', monospace" size="3"><span style="font-family:Verdana,Helvetica,Arial,sans-serif;font-style:normal;font-size:13px"><i><font face="'courier new', monospace" size="3"><br /></font></i></span></font></i></div><div><i><font face="'courier new', monospace" size="3"><span style="font-family:Verdana,Helvetica,Arial,sans-serif;font-style:normal;font-size:13px"><i><font face="'courier new', monospace" size="3"><br /></font></i></span></font></i></div><div><i><font face="'courier new', monospace" size="3"><span style="font-family:Verdana,Helvetica,Arial,sans-serif;font-style:normal;font-size:13px"><i><font face="'courier new', monospace" size="3"><span style="font-family:Verdana,Helvetica,Arial,sans-serif;font-style:normal;font-size:13px"><i><font face="'courier new', monospace" size="3">Phase and Frequency Corrected PWM mode:</font></i></span></font></i></span></font></i></div><div><br /></div><div><span>    Phase Corrected and Phase and Frequency Corrected PWM modes function the same way if we are not planning on changing our TOP value once the PWM mode is started.  The only difference that I could see on the data sheet is that the Phase and Frequency Corrected mode updates its TOP value when it hits Bottom while the Phase Corrected mode updates its TOP value when it hits the TOP.</span><br /></div><div><span><br /></span></div><div><span><span>    If anyone knows anything more (or if I'm wrong) about these 2 modes please let me know.</span></span></div><div><br /></div><div><i><font face="'courier new', monospace" size="3"><span style="font-family:Verdana,Helvetica,Arial,sans-serif;font-style:normal;font-size:13px"><i><font face="'courier new', monospace" size="3"><span style="font-family:Verdana,Helvetica,Arial,sans-serif;font-style:normal;font-size:13px"><div><span>    This mode is recommended for motor control.</span></div><div><span><br /></span></div><div><span><span>    The frequency of the Phase and Frequency Corrected PWM can be calculated by the following equation.</span></span></div><div><span><br /></span></div><blockquote style="border-style:none;margin:0px 0px 0px 40px;padding:0px"><div><font color="#0000ff">PWM_frequency = clock_speed / (2 * Prescaller_value * TOP_value )</font></div></blockquote></span></font></i></span></font></i></div><div><br /></div><div><br /></div><div><br /></div><div><div><div><span><table border="1" bordercolor="#888888" cellspacing="0" style="border-color:rgb(136,136,136);border-width:1px;margin:0px;text-align:center;border-collapse:collapse"><tbody><tr><td style="vertical-align:top;text-align:center;width:59px;height:15px"> </td><td style="vertical-align:top;text-align:center;width:59px"><b> 7 bit</b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 6 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 5 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 4 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 3 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 2 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 1 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 0 bit</b> </td></tr><tr><td style="vertical-align:top;text-align:center;height:15px"><b>TCCR1A</b></td><td style="vertical-align:top;text-align:center">COM1A1</td><td style="vertical-align:top;text-align:center">COM1A0 </td><td style="vertical-align:top;text-align:center">COM1B1</td><td style="vertical-align:top;text-align:center">COM1B0</td><td style="vertical-align:top;text-align:center">FOC1A</td><td style="vertical-align:top;text-align:center"> FOC1B</td><td style="vertical-align:top;text-align:center"> WGM11</td><td style="vertical-align:top;text-align:center">WGM10 </td></tr></tbody></table><div style="text-align:left;font-family:courier new,monospace"><i>Timer/Counter Control Register 1 A</i></div></span></div><blockquote style="border-style:none;margin:0px 0px 0px 40px;padding:0px"><div><br /></div></blockquote></div><div><div><br /></div><div><blockquote style="border-style:none;margin:0px 0px 0px 40px;padding:0px"><div><div><table border="1" bordercolor="#888888" cellspacing="0" style="border-color:rgb(136,136,136);border-width:1px;margin:0px;border-collapse:collapse"><tbody><tr><td style="vertical-align:top;width:50px;height:15px"><b>COM1A1<br />COM1B1</b></td><td style="vertical-align:top;width:50px;height:15px"><b>COM1A0<br />COM1B0</b></td><td style="vertical-align:top;width:431px;height:15px"><b> <br /> DESCRIPTION</b></td></tr><tr><td style="vertical-align:top;text-align:center;width:50px;height:15px">0</td><td style="vertical-align:top;text-align:center;width:50px;height:15px">0 </td><td style="vertical-align:top;text-align:left;width:431px;height:15px"> Normal port operation, OC1A/OC1B disconnected.</td></tr><tr><td style="vertical-align:top;text-align:center;width:50px;height:15px">0</td><td style="vertical-align:top;text-align:center;width:50px;height:15px">1 </td><td style="vertical-align:top;text-align:left;width:431px;height:15px"> Mode 9, 14, 15 only: Enable OCR1A only (OC1B disconnected)</td></tr><tr><td style="vertical-align:top;text-align:center;width:50px;height:15px">1</td><td style="vertical-align:top;text-align:center;width:50px;height:15px">0 </td><td style="vertical-align:top;text-align:left;width:431px;height:15px"> None-inverted mode (HIGH at bottom, LOW on Match)</td></tr><tr><td style="vertical-align:top;text-align:center;width:50px;height:15px">1</td><td style="vertical-align:top;text-align:center;width:50px;height:15px">1 </td><td style="vertical-align:top;text-align:left;width:431px;height:15px"> Inverted mode (LOW at bottom, HIGH on Match)</td></tr></tbody></table></div></div></blockquote><blockquote style="border-style:none;margin:0px 0px 0px 40px;padding:0px;font-family:courier new,monospace"><div><div><i>Applies only to PWM modes</i></div></div></blockquote></div><div><br /></div><div><br /></div><div><table border="1" bordercolor="#888888" cellspacing="0" style="border-color:rgb(136,136,136);border-width:1px;margin:0px;text-align:center;border-collapse:collapse"><tbody><tr><td style="vertical-align:top;text-align:center;width:59px;height:15px"> </td><td style="vertical-align:top;text-align:center;width:59px"><b> 7 bit</b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 6 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 5 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 4 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 3 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 2 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 1 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 0 bit</b> </td></tr><tr><td style="vertical-align:top;text-align:center;height:15px"><b>TCCR1B</b></td><td style="vertical-align:top;text-align:center"><font color="#666666">ICNC1</font></td><td style="vertical-align:top;text-align:center"><font color="#666666">ICES1</font></td><td style="vertical-align:top;text-align:center">-</td><td style="vertical-align:top;text-align:center">WGM13</td><td style="vertical-align:top;text-align:center">WGM12</td><td style="vertical-align:top;text-align:center"> CS12</td><td style="vertical-align:top;text-align:center"> CS11</td><td style="vertical-align:top;text-align:center">CS10 </td></tr></tbody></table><div style="text-align:left;font-family:courier new,monospace"><i>Timer/Counter Control Register 1 B</i></div></div><div><br /></div><div><br /></div><div><blockquote style="border-style:none;margin:0px 0px 0px 40px;padding:0px"><div><table border="1" bordercolor="#888888" cellspacing="0" style="border-color:rgb(136,136,136);border-width:1px;margin:0px;border-collapse:collapse"><tbody><tr><td style="vertical-align:top;width:54px;height:15px"><b> CS12</b></td><td style="vertical-align:top;width:54px;height:15px"><b> CS11 </b></td><td style="vertical-align:top;width:54px;height:15px"><b> CS10 </b></td><td style="vertical-align:top;width:365px;height:15px"><b> DESCRIPTION</b></td></tr><tr><td style="vertical-align:top;text-align:center;width:54px;height:15px">0</td><td style="vertical-align:top;text-align:center;width:54px;height:15px">0 </td><td style="vertical-align:top;text-align:center;width:54px;height:15px">0 </td><td style="vertical-align:top;text-align:left;width:365px;height:15px"> Timer/Counter2 Disabled </td></tr><tr><td style="vertical-align:top;text-align:center;width:54px;height:15px">0</td><td style="vertical-align:top;text-align:center;width:54px;height:15px">0 </td><td style="vertical-align:top;text-align:center;width:54px;height:15px">1 </td><td style="vertical-align:top;text-align:left;width:365px;height:15px"> No Prescaling</td></tr><tr><td style="vertical-align:top;text-align:center">0</td><td style="vertical-align:top;text-align:center">1 </td><td style="vertical-align:top;text-align:center">0 </td><td style="vertical-align:top"> Clock / 8</td></tr><tr><td style="vertical-align:top;text-align:center">0</td><td style="vertical-align:top;text-align:center">1 </td><td style="vertical-align:top;text-align:center">1 </td><td style="vertical-align:top"> Clock / 64</td></tr><tr><td style="vertical-align:top;text-align:center">1</td><td style="vertical-align:top;text-align:center">0 </td><td style="vertical-align:top;text-align:center">0 </td><td style="vertical-align:top"> Clock / 256</td></tr><tr><td style="vertical-align:top;text-align:center">1</td><td style="vertical-align:top;text-align:center">0 </td><td style="vertical-align:top;text-align:center">1 </td><td style="vertical-align:top"> Clock / 1024</td></tr><tr><td style="vertical-align:top;text-align:center;width:54px;height:15px;color:rgb(153,153,153);background-color:rgb(243,243,243)">1</td><td style="vertical-align:top;text-align:center;width:54px;height:15px;color:rgb(153,153,153);background-color:rgb(243,243,243)">1 </td><td style="vertical-align:top;text-align:center;width:54px;height:15px;color:rgb(153,153,153);background-color:rgb(243,243,243)">0 </td><td style="vertical-align:top;text-align:left;width:365px;height:15px;color:rgb(153,153,153);background-color:rgb(243,243,243)"> External clock source on T1 pin, Clock on Falling edge</td></tr><tr><td style="vertical-align:top;text-align:center;width:54px;height:15px;color:rgb(153,153,153);background-color:rgb(243,243,243)">1</td><td style="vertical-align:top;text-align:center;width:54px;height:15px;color:rgb(153,153,153);background-color:rgb(243,243,243)">1 </td><td style="vertical-align:top;text-align:center;width:54px;height:15px;color:rgb(153,153,153);background-color:rgb(243,243,243)">1 </td><td style="vertical-align:top;text-align:left;width:365px;height:15px;color:rgb(153,153,153);background-color:rgb(243,243,243)"> External clock source on T1 pin, Clock on rising edge</td></tr></tbody></table><i style="font-family:courier new,monospace">CS bits</i></div><div><i><br /></i></div></blockquote></div><div><br /></div><div><blockquote style="border-style:none;margin:0px 0px 0px 40px;padding:0px"><div><div><table border="1" bordercolor="#888888" cellspacing="0" style="border-color:rgb(136,136,136);border-width:1px;margin:0px;border-collapse:collapse"><tbody><tr><td style="vertical-align:top;width:50px;height:15px"><b> MODE</b></td><td style="width:58px;height:15px"><b>WGM13</b></td><td style="width:56px;height:15px"><b>WGM12</b></td><td style="vertical-align:top;width:53px;height:15px"><b>WGM11</b></td><td style="vertical-align:top;width:53px;height:15px"><b>WGM10</b></td><td style="vertical-align:top;width:267px;height:15px"><b> DESCRIPTION</b></td><td style="width:60px"> <b>TOP</b></td></tr><tr><td style="vertical-align:top;text-align:center;width:50px;height:15px;background-color:rgb(243,243,243)"><font color="#999999">0</font></td><td style="text-align:center;width:58px;height:15px;background-color:rgb(243,243,243)"><font color="#999999">0</font></td><td style="text-align:center;width:56px;height:15px;background-color:rgb(243,243,243)"><font color="#999999">0 </font></td><td style="vertical-align:top;text-align:center;width:53px;height:15px;background-color:rgb(243,243,243)"><font color="#999999">0</font></td><td style="vertical-align:top;text-align:center;width:53px;height:15px;background-color:rgb(243,243,243)"><font color="#999999">0</font></td><td style="vertical-align:top;text-align:left;width:267px;height:15px;background-color:rgb(243,243,243)"><font color="#999999"> Normal </font></td><td style="width:60px;background-color:rgb(243,243,243)"> </td></tr><tr><td style="vertical-align:top;text-align:center;width:50px;height:15px">1</td><td style="text-align:center;width:58px;height:15px">0</td><td style="text-align:center;width:56px;height:15px">0</td><td style="vertical-align:top;text-align:center;width:53px;height:15px">0</td><td style="vertical-align:top;text-align:center;width:53px;height:15px">1</td><td style="vertical-align:top;text-align:left;width:267px;height:15px"> PWM, Phase Corrected, 8bit</td><td style="width:60px"> 0x00FF</td></tr><tr><td style="vertical-align:top;text-align:center;width:50px;height:15px">2</td><td style="text-align:center;width:58px;height:15px">0</td><td style="text-align:center;width:56px;height:15px">0</td><td style="vertical-align:top;text-align:center;width:53px;height:15px">1</td><td style="vertical-align:top;text-align:center;width:53px;height:15px">0</td><td style="vertical-align:top;text-align:left;width:267px;height:15px"> PWM, Phase Corrected, 9bit</td><td style="width:60px"> 0x01FF</td></tr><tr><td style="vertical-align:top;text-align:center;width:50px;height:15px">3</td><td style="text-align:center;width:58px;height:15px">0</td><td style="text-align:center;width:56px;height:15px">0</td><td style="vertical-align:top;text-align:center;width:53px;height:15px">1</td><td style="vertical-align:top;text-align:center;width:53px;height:15px">1</td><td style="vertical-align:top;text-align:left;width:267px;height:15px"> PWM, Phase Corrected, 10bit </td><td style="text-align:center;width:60px">0x03FF </td></tr><tr><td style="text-align:center">5</td><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:left"> Fast PWM, 8bit </td><td style="text-align:center">0x00FF </td></tr><tr><td style="text-align:center">6</td><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:left"> Fast PWM, 9bit </td><td style="text-align:center">0x01FF </td></tr><tr><td style="text-align:center">7</td><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:left"> Fast PWM, 10bit </td><td style="text-align:center">0x03FF </td></tr><tr><td style="text-align:center">8</td><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:left"> PWM, Phase and Frequency Corrected </td><td style="text-align:center">ICR1 </td></tr><tr><td style="text-align:center">9</td><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:left"> PWM, Phase and Frequency Corrected </td><td style="text-align:center">OCR1A </td></tr><tr><td style="text-align:center">10</td><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:left"> PWM, Phase Correct </td><td style="text-align:center">ICR1 </td></tr><tr><td style="text-align:center">11</td><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:left"> PWM, Phase Correct </td><td style="text-align:center"> OCR1A</td></tr><tr><td style="text-align:center">14</td><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:left"> Fast PWM </td><td style="text-align:center">ICR1 </td></tr><tr><td style="text-align:center">15</td><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">1</td><td> Fast PWM</td><td style="text-align:center">OCR1A </td></tr></tbody></table></div></div></blockquote><blockquote style="border-style:none;margin:0px 0px 0px 40px;padding:0px;font-family:courier new,monospace"><div><div><i>Waveform Generator Mode bits (Abbreviated)</i></div></div></blockquote></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><table border="1" bordercolor="#888888" cellspacing="0" style="border-color:rgb(136,136,136);border-width:1px;margin:0px;text-align:center;border-collapse:collapse"><tbody><tr><td style="vertical-align:top;text-align:center;width:59px;height:15px"> </td><td style="vertical-align:top;text-align:center;width:59px"><b> 7 bit</b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 6 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 5 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 4 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 3 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 2 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 1 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 0 bit</b> </td></tr><tr><td style="vertical-align:top;text-align:center;height:15px"> <b>TIMSK</b></td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)"> OCIE2</td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)">TOIE2 </td><td style="vertical-align:top;text-align:center">TICIE1 </td><td style="vertical-align:top;text-align:center">OCIE1A </td><td style="vertical-align:top;text-align:center">OCIE1B </td><td style="vertical-align:top;text-align:center"> TOIE1</td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)"> -</td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)">TOIE0 </td></tr></tbody></table><div style="text-align:left;font-family:courier new,monospace"><i>Timer/Counter Interrupt Mask Register</i></div></div><div style="text-align:left"><i><br /></i></div><div style="text-align:left"><i><br /></i></div><div style="text-align:left"><i><span style="font-style:normal"><table border="1" bordercolor="#888888" cellspacing="0" style="border-color:rgb(136,136,136);border-width:1px;margin:0px;text-align:center;border-collapse:collapse"><tbody><tr><td style="vertical-align:top;text-align:center;width:59px;height:15px"> </td><td style="vertical-align:top;text-align:center;width:59px"><b> 7 bit</b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 6 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 5 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 4 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 3 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 2 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 1 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 0 bit</b> </td></tr><tr><td style="vertical-align:top;text-align:center;height:15px"> <b>TIFR</b></td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)"> OCF2</td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)">TOV2 </td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)">ICF1 </td><td style="vertical-align:top;text-align:center">OCF1A </td><td style="vertical-align:top;text-align:center">OCF1B </td><td style="vertical-align:top;text-align:center"><font color="#666666"> </font>TOV1</td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)"> -</td><td style="vertical-align:top;text-align:center;color:rgb(153,153,153);background-color:rgb(243,243,243)">TOV0 </td></tr></tbody></table><div style="text-align:left;font-family:courier new,monospace"><i>Timer/Counter Interrupt Flag Register</i></div></span></i></div><div><br /></div><div><br /></div><div><i><span style="font-style:normal"><table border="1" bordercolor="#888888" cellspacing="0" style="border-color:rgb(136,136,136);border-width:1px;margin:0px;text-align:center;border-collapse:collapse"><tbody><tr><td style="vertical-align:top;text-align:center;width:59px;height:15px"> </td><td style="vertical-align:top;text-align:center;width:59px"><b> 7 bit</b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 6 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 5 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 4 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 3 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 2 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 1 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 0 bit</b> </td></tr><tr><td style="vertical-align:top;text-align:center;height:15px"><b>TCNT1H</b></td><td style="vertical-align:top;text-align:center"> </td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"> </td></tr><tr><td> <b>TCNT1L</b></td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr></tbody></table><div style="text-align:left;font-family:courier new,monospace"><i>Timer/Counter Register (stores the counter value, 16 bit)</i></div><div><i><br /></i></div><div><i><br /></i></div></span></i></div></div><div><i><span style="font-style:normal"><table border="1" bordercolor="#888888" cellspacing="0" style="border-color:rgb(136,136,136);border-width:1px;margin:0px;text-align:center;border-collapse:collapse"><tbody><tr><td style="vertical-align:top;text-align:center;width:59px;height:15px"> </td><td style="vertical-align:top;text-align:center;width:59px"><b> 7 bit</b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 6 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 5 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 4 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 3 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 2 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 1 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 0 bit</b> </td></tr><tr><td style="vertical-align:top;text-align:center;height:15px"><b>OCR1AH</b></td><td style="vertical-align:top;text-align:center"> </td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"> </td></tr><tr><td><b>OCR1AL</b></td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr></tbody></table><div style="text-align:left;font-family:courier new,monospace"><i>Output Compare Register A (stores the compare value, 16 bit)</i></div></span></i></div></div><div><br /></div><div><br /></div><div><i><span style="font-style:normal"><table border="1" bordercolor="#888888" cellspacing="0" style="border-color:rgb(136,136,136);border-width:1px;margin:0px;text-align:center;border-collapse:collapse"><tbody><tr><td style="vertical-align:top;text-align:center;width:59px;height:15px"> </td><td style="vertical-align:top;text-align:center;width:59px"><b> 7 bit</b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 6 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 5 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 4 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 3 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 2 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 1 bit </b></td><td style="vertical-align:top;text-align:center;width:59px"><b> 0 bit</b> </td></tr><tr><td style="vertical-align:top;text-align:center;height:15px"><b>OCR1BH</b></td><td style="vertical-align:top;text-align:center"> </td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"><br /></td><td style="vertical-align:top;text-align:center"> </td></tr><tr><td style="vertical-align:top"><b>OCR1BL</b></td><td style="vertical-align:top"> </td><td style="vertical-align:top"> </td><td style="vertical-align:top"> </td><td style="vertical-align:top"> </td><td style="vertical-align:top"> </td><td style="vertical-align:top"> </td><td style="vertical-align:top"> </td><td style="vertical-align:top"> </td></tr></tbody></table><div style="text-align:left;font-family:courier new,monospace"><i>Output Compare Register B (stores the compare value, 16 bit)</i></div></span></i></div><div><br /></div><div><br /></div><div><div><i>ATmega8 Code:</i><br /></div><div class="sites-codeblock sites-codesnippet-block" style="border:1px solid rgb(211,211,211);padding:0.5em 0px 0.5em 1em;background-color:rgb(239,239,239);display:block;line-height:13px"><div><code style="color:rgb(0,96,0)">// this code sets up counter1 for an 4kHz, 10bit, Phase Corrected PWM </code></div><div><code style="color:rgb(0,96,0)">// @ 16Mhz Clock</code><br /><br /><br /><code style="color:rgb(0,96,0)">#include &lt;avr/io.h&gt;</code><br /><br /><br /><code style="color:rgb(0,96,0)">int main(void)</code><br /><code style="color:rgb(0,96,0)">{</code><br /><code style="color:rgb(0,96,0)"><span>    </span>DDRB |= (1 &lt;&lt; DDB1);</code><br /><code style="color:rgb(0,96,0)"><span>    </span>// PB1 is now an output</code></div><div><font color="#006000" face="monospace"><br /></font></div><div><font color="#006000" face="monospace"><span>    OCR1A = 0x01FF;</span></font></div><div><font color="#006000" face="monospace"><span>    // set PWM for 50% duty cycle @ 10bit</span><br /></font><br /></div><div><br /></div><div><code style="color:rgb(0,96,0)"><span><span>    TCCR1A |= (1 &lt;&lt; COM1A1);</span></span></code></div><div><code style="color:rgb(0,96,0)"><span><span>    // set none-inverting mode</span></span><br /></code></div><div><code style="color:rgb(0,96,0)"><span><br /></span></code></div><div><code style="color:rgb(0,96,0)"><span><span>    TCCR1A |= (1 &lt;&lt; WGM11) | (1 &lt;&lt; WGM10);</span><br /></span></code></div><div><code style="color:rgb(0,96,0)"><span><span><span>    // set 10bit phase corrected PWM Mode</span><br /></span></span></code></div><div><br /></div><div><code style="color:rgb(0,96,0)"><span>    </span>TCCR1B |= (1 &lt;&lt; CS11);</code><br /><code style="color:rgb(0,96,0)"><span>    </span>// set prescaler to 8 and starts PWM</code></div><div><br /><br /><code style="color:rgb(0,96,0)"><span>    </span>while (1)</code><br /><code style="color:rgb(0,96,0)"><span>    </span>{</code><br /><code style="color:rgb(0,96,0)"><span>    <span>    </span></span>// we have a working Fast PWM</code></div><div><code style="color:rgb(0,96,0)"><span>    </span>}</code><br /><code style="color:rgb(0,96,0)">}</code></div></div></div><div><br /><br /><hr size="2" width="100%" /><br /><br /><font size="3"><b style="font-family:courier new,monospace">OTHER RESOURCES:</b></font><br /><br /><br /><a href="http://www.atmel.com/dyn/resources/prod_documents/doc2542.pdf" target="_blank" rel="nofollow">AVR131: Using the AVR's High Speed PWM</a><br /><br /><br /><hr size="2" width="100%" /><br /><br /></div><div><span>    Believe it or not this tutorial almost killed me.  I don't know why, maybe its because I'm so close to releasing the site to the public.  </span></div><div><span><br /></span></div><div><span><br /></span></div><div><span>Cheers.</span></div><div><span>Q</span></div><div><br /></div><div><br /></div><div><br /></div></div></div><div class="sites-layout-tile sites-tile-name-footer"><div dir="ltr"><div style="text-align:right">Comments? Questions? Problems with content?  <a href="mailto:q.qeewiki@gmail.com" style="color:rgb(0,0,204);text-decoration:underline">q.qeewiki@gmail.com</a></div><div style="text-align:right"><br /></div><div style="text-align:right"><br /></div><div style="text-align:right"><br /></div><div style="text-align:right"><div><div class="sites-embed-align-left-wrapping-off"><div class="sites-embed-border-off sites-embed" style="width:728px;"><div class="sites-embed-content sites-embed-type-adsense"><script type="text/javascript">
<!--
google_ad_client="pub-5107231512580887";
google_ad_host="pub-6693688277674466";
google_ad_width=728;
google_ad_height=90;
google_ad_format="728x90_as";
google_ad_type="text_image";
google_color_border="CCCCCC";
google_color_bg="FFFFFF";
google_color_link="000000";
google_color_url="0000CC";
google_color_text="000000";
//-->
</script><script type="text/javascript" src="https://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div></div></div></div><br /></div></div></div></div>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://accounts.google.com/ServiceLogin?continue=https://sites.google.com/site/qeewiki/books/avr-guide/pwm-atmega8&amp;service=jotspot">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="https://sites.google.com/site/qeewiki/system/app/pages/reportAbuse" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com/site">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="https://ssl.gstatic.com/sites/p/cc68c3/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[{"action":"/site/qeewiki/system/app/pages/search","id":"search-site","label":"Search this site"}]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/site/qeewiki/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("2bd", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_2bd');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("5818525579565211", "Resources", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_5818525579565211');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("6477897660156883", "None EE Faves", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_6477897660156883');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXvZ96OgAtmrDShx3wcwne5zycb4OvuFMl9d3N2ZmP8xLMJtSU8rXpb0nqOVGqpiTTokgQrtxdMkS8JXcPmRukmfa3fupJ87u7W020hIjNzpbscDlESiuTJnfIxT699HEgJNwFUZ/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([1109635200000, 1128902400000, 1130657000000, 1143333000000, 1143806400000, 1145000000000, 1146380000000, 1152489600000, 1159800000000, 1159500000000, 1162095000000, 1162075000000, 1162105500000]);
    gsites.Xhr.send('https://sites.google.com/site/qeewiki/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'https://gg.google.com/csi');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<script type="text/javascript">
          sites.codeembed.init();
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>
</html>
